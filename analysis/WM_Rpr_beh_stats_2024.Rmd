---
title: "Duration reproduction under memory pressure"
author: "Strongway, Jiao Wu et al."
date: "2024-09-10"
description: "Statistical Analyses"
output:
  pdf_document: 
    number_sections: true
  html_document:
    df_print: paged
    number_sections: true
latex_engine: xelatex
---

# Load packages and functions and data

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)
library(ez)
library(tidyverse)
library(lme4)
library(rstatix)
library(ggpubr)
library(lmerTest)
library(sjPlot)
library(cowplot)
source('mytheme.R')

ExpData = read.csv(paste0("../data/AllValidData.csv"))
ExpData6 <- read.csv(paste0("../data/Exp6.csv")) %>% filter(valid == 1)

# add meaningful name for each experiment based on Exp number
ExpData = ExpData %>% mutate(ExpName = case_when(Exp == "Exp1" ~ 'Baseline',
                                                        Exp == "Exp2" ~ 'Encoding',
                                                        Exp == "Exp3" ~ 'Reproduction',
                                                        Exp == "Exp4" ~ 'Both',
                                                        Exp == "Exp5" ~ 'Both_gap'))
ExpData6 = ExpData6 %>% mutate(ExpName = case_when(Exp == "Exp. 6a" ~ 'Encoding2',
                                                        Exp == "Exp. 6b" ~ 'Reproduction2',
                                                        Exp == "Exp. 6c" ~ 'baseline2'),
                               gap = 1)

# concatenate two datasets
ExpData = bind_rows(ExpData, ExpData6)

# add working memory responses
ExpData$WMCrr <- ExpData$TPresent == ExpData$WMRP
# add reproduction error (bias)
ExpData$bias <- ExpData$repDur - ExpData$curDur

# map WMSize to a new column Load: 1 - low, 2 - medium, 3 - high
ExpData$Load = factor(ExpData$WMSize, levels = c(1, 3, 5), labels = c('Low', 'Medium', 'High'))

```

## mean reproduction biases and working memory performance

Calculate mean reproduction biases and working memory performance for each experiment.

```{r meandata, message=FALSE, warning=FALSE}
# mean reproduction biases
mRep = ExpData %>% group_by(ExpName, NSub, WMSize, Load, gap, curDur, DurLevel) %>% 
  summarise(m_bias = mean(bias), se_bias = sd(bias)/sqrt(n()), cv = sd(repDur)/mean(repDur), n = n()) 
mRep$DurLevel = as.factor(mRep$DurLevel)

# general bias
mBias = mRep %>% group_by(ExpName, Load, gap, NSub) %>% 
  summarise(ms_bias = mean(m_bias)*1000, se_bias = sd(m_bias)/sqrt(n())*1000)

# mean working memory performance
mWM = ExpData %>% group_by(ExpName, NSub, WMSize,gap, Load) %>% 
  summarise(m_WMCrr = mean(WMCrr), se_WMCrr = sd(WMCrr)/sqrt(n()), n = n())

```

## Central tendency effect

Next, we estimate the central tendency effect by using linear regression. First, we prepare several useful functions

```{r functions, message=FALSE, warning=FALSE}

# a simple linear model function
lm_model <- function(df) {
  lm(m_bias ~ curDur, data = df)
}

# obtain the estimates of the linear model
lm_estimate <- function(df) {
  df %>% group_by(ExpName, NSub, gap, Load) %>% nest() %>% 
  mutate(lm = map(data, lm_model)) %>% # linear regression
  mutate(slope = map(lm, broom::tidy)) %>%  # get estimates
  unnest(slope) %>% # remove raw data
  dplyr::select(-std.error,-statistic, -p.value) %>%  # remove unnessary columns
  spread(term, estimate) %>%   # spread stimates
  dplyr::rename(Intercept = `(Intercept)`, slope = curDur) %>% # rename columns
  mutate(cti = -slope) # central tendency index
}

# now estimate the central tendency effect
mRep_cti = mRep %>% lm_estimate()

```

## save to long sheet data

```{r saveLongSheetData, message=FALSE, warning=FALSE, include=FALSE}
# save mean bias
saveLong_mBias <- function(df, expname) {
  tmp = subset(df %>% filter(ExpName == expname), 
               select=c(curDur, Load, gap, NSub, m_bias)) %>% 
    pivot_wider(names_from = c("curDur","Load","gap"), 
                values_from = c(m_bias), names_sep="_")
  write.csv(tmp, paste0(getwd(),"/bhvrlt/DataAna_20240914/mBias_",expname,".csv"))
}

saveLong_mBias(mRep, "Encoding")
saveLong_mBias(mRep, "Reproduction")
saveLong_mBias(mRep, "Both")
saveLong_mBias(mRep, "Both_gap")
saveLong_mBias(mRep, "Baseline")
saveLong_mBias(mRep, "Encoding2")
saveLong_mBias(mRep, "Reproduction2")
saveLong_mBias(mRep, "baseline2")

# save cv of bias
saveLong_cvBias <- function(df, expname) {
  tmp = subset(df %>% filter(ExpName == expname), 
               select=c(curDur, Load, gap, NSub, cv)) %>% 
    pivot_wider(names_from = c("curDur","Load","gap"), 
                values_from = c(cv), names_sep="_")
  write.csv(tmp, paste0(getwd(),"/bhvrlt/DataAna_20240914/cv_",expname,".csv"))
}

saveLong_cvBias(mRep, "Encoding")
saveLong_cvBias(mRep, "Reproduction")
saveLong_cvBias(mRep, "Both")
saveLong_cvBias(mRep, "Both_gap")
saveLong_cvBias(mRep, "Baseline")
saveLong_cvBias(mRep, "Encoding2")
saveLong_cvBias(mRep, "Reproduction2")
saveLong_cvBias(mRep, "baseline2")

# save general bias
saveLong_gBias <- function(df, expname) {
  tmp = subset(df %>% filter(ExpName == expname), select=c(Load, gap, NSub, ms_bias)) %>% 
    pivot_wider(names_from = c("Load","gap"), values_from = c(ms_bias), names_sep="_")
  write.csv(tmp, paste0(getwd(),"/bhvrlt/DataAna_20240914/gBias_",expname,".csv"))
}

saveLong_gBias(mBias, "Encoding")
saveLong_gBias(mBias, "Reproduction")
saveLong_gBias(mBias, "Both")
saveLong_gBias(mBias, "Both_gap")
saveLong_gBias(mBias, "Baseline")
saveLong_gBias(mBias, "Encoding2")
saveLong_gBias(mBias, "Reproduction2")
saveLong_gBias(mBias, "baseline2")

# save CTI
saveLong_cti <- function(df, expname) {
  tmp = subset(df %>% filter(ExpName == expname), select=c(Load, gap, NSub, cti)) %>% 
    pivot_wider(names_from = c("Load","gap"), values_from = c(cti), names_sep="_")
  write.csv(tmp, paste0(getwd(),"/bhvrlt/DataAna_20240914/CTI_",expname,".csv"))
}

saveLong_cti(mRep_cti, "Encoding")
saveLong_cti(mRep_cti, "Reproduction")
saveLong_cti(mRep_cti, "Both")
saveLong_cti(mRep_cti, "Both_gap")
saveLong_cti(mRep_cti, "Baseline")
saveLong_cti(mRep_cti, "Encoding2")
saveLong_cti(mRep_cti, "Reproduction2")
saveLong_cti(mRep_cti, "baseline2")

```

## Plotting functions

```{r plotfunction, message=FALSE, warning=FALSE}

#plot reproduction bias by duration and memory load (central tendency effect) based on mRep
plot_cti <- function(data){
  # from subject-level to group-level
  data %>% group_by(Load, curDur) %>% summarise(mm_bias = mean(m_bias), se_bias = sd(m_bias)/sqrt(n())) %>%
  ggplot(aes(curDur, mm_bias,  color = Load, shape = Load)) + 
    geom_point(size = 2, stat = 'identity') + geom_line() + 
    geom_errorbar(aes(ymin = mm_bias - se_bias, ymax = mm_bias + se_bias), width = 0.05) +
    coord_cartesian(ylim = c(-0.5, 0.5)) +
    scale_x_continuous(breaks=c(0.5, 0.8, 1.1, 1.4, 1.7)) + # add horizontal dash line 0
    geom_hline(yintercept = 0, linetype = "dashed", color = "darkgrey") +
    labs(x="", y="Reproduction bias (s)", 
       shape ="Memory Load", color = "Memory Load") +
    theme_new + greySet3 +   theme(legend.position = c(.8,.8), 
        legend.text = element_text(size = 10), 
        legend.title = element_text(size = 10, face = "bold"),
        plot.title = element_text(hjust = 0.5))
}

# plot cv by duration and memory load based on mRep
plot_cv <- function(data){
  data %>% group_by(Load, curDur) %>% summarise(m_cv = mean(cv), se_cv = sd(cv)/sqrt(n())) %>%
  ggplot(aes(curDur, m_cv, color = Load, shape = Load)) + 
    geom_point(size = 2, stat = 'identity') + geom_line() + 
    geom_errorbar(aes(ymin = m_cv - se_cv, ymax = m_cv + se_cv), width = 0.05) +
    scale_x_continuous(breaks=c(0.5, 0.8, 1.1, 1.4, 1.7)) +
    labs(x="Durations (s)", y="CV", 
       shape ="Memory Load", color = "Memory Load") +
    theme_new + greySet3 +   theme(legend.position = "none")
}

# plot mean biases by memory load based on mBias
plot_bias_Load <- function(data){
  data %>% group_by(Load) %>% summarise(bias = mean(ms_bias), se_bias = sd(ms_bias)/sqrt(n())) %>%
  ggplot(aes(Load, bias, fill = Load)) + 
    geom_bar(stat = 'identity', width = 0.75) + 
    geom_errorbar(aes(ymin = bias - se_bias, ymax = bias + se_bias, color = Load), width = 0.3) +
    scale_y_reverse() + coord_cartesian(ylim = c(-20, -180)) +
    labs(x="Memory Load", y="Mean Bias (ms)", fill = "Memory Load", color = 'Memory Load') +
    theme_new + fillGreySet3 + greySet3 + theme(legend.position = "none", 
        plot.title = element_text(hjust = 0.5))
}

# plot mean cti by memory load
plot_cti_Load <-function(data){
  data %>% group_by(Load) %>% summarise(m_cti = mean(cti), se_cti = sd(cti)/sqrt(n())) %>%
    ggplot(aes(Load, m_cti, fill = Load)) + 
    geom_bar(stat = 'identity', width = 0.75) + 
    geom_errorbar(aes(ymin = m_cti - se_cti, ymax = m_cti + se_cti, color = Load), width = 0.3) +
    coord_cartesian(ylim = c(0.1, 0.8)) +
    labs(x="Memory Load", y="CTI", fill = "Memory Load", color = "Memory Load") +
    theme_new + fillGreySet3 + greySet3 + theme(legend.position = "none", 
        plot.title = element_text(hjust = 0.5))
}

# output three figures together
plot_fig <- function(Name, subfig = FALSE) {
  fig_a = mRep %>% filter(ExpName == Name) %>% plot_cti()
  fig_cv = mRep %>% filter(ExpName == Name) %>% plot_cv()
  fig_b = mRep_cti %>% filter(ExpName == Name) %>% plot_cti_Load()
  fig_c = mBias %>% filter(ExpName == Name) %>% plot_bias_Load()
  if(subfig) {
    return(list(fig_a=fig_a, fig_b=fig_b, fig_c=fig_c, fig_cv = fig_cv))
  } else {
    plot_grid(fig_a, fig_b, fig_cv, fig_c, labels = c('a', 'b', 'c','d'), nrow = 2)
  }
}
```

## Function for ANOVA tests

```{r anova-Greenhouse-Geisser-correction-function, message=FALSE, warning=FALSE}
# Function for Greenhouse-Geisser corrections in ANOVA
GGcr <- function(av){
  list <- av$`Mauchly's Test for Sphericity`$Effect[av$`Mauchly's Test for Sphericity`$p < 0.05]
  av_GGcr <- data.frame(Effect=character(), DFn=double(), DFd=double(), 
                        Fval=double(),p=double(), ges=double(), partial_eta2=double())
  for (effect in list) {
    Effect <- paste(effect,"GG corrected")
    idx1 = av$`Sphericity Corrections`$Effect == effect
    idx2 = av$ANOVA$Effect == effect
    DFn <- av$`Sphericity Corrections`$GGe[idx1] * av$ANOVA$DFn[idx2]
    DFd <- av$`Sphericity Corrections`$GGe[idx1] * av$ANOVA$DFd[idx2]
    Fval <- av$ANOVA$F[idx2]
    p <- av$`Sphericity Corrections`$`p[GG]`[idx1]
    ges <- av$ANOVA$ges[idx2]
    partial_eta2 <- av$ANOVA$partial_eta2[idx2]
    av_GGcr[nrow(av_GGcr)+1,] = data.frame(Effect, DFn, DFd, Fval, p, ges, partial_eta2)
  }
  return(av_GGcr)
}

# Function for calculate partial eta square in ANOVA
calParEta2 <- function(tmp_aov){
  tmp_aov$ANOVA$partial_eta2 <- tmp_aov$ANOVA$SSn/(tmp_aov$ANOVA$SSn+tmp_aov$ANOVA$SSd)
  return(tmp_aov)
}

```

# 1. Working memory impacts on the encoding phase

```{r plotfigs, message=FALSE, warning=FALSE}
# encoding manipulation
fig_encoding = plot_fig('Encoding', subfig = TRUE)
fig_encoding$fig_b = fig_encoding$fig_b + 
  geom_signif(y_position = c(0.71, 0.77), xmin = c(1,1), xmax = c(2, 3), 
              annotation = c("***", "***")) + ylim(0, 0.8)
fig_en = plot_grid(fig_encoding$fig_b, fig_encoding$fig_c, 
                   labels = c('a', 'b'))
fig_en
# save figures
ggsave("./figures/fig_encoding.png", fig_en, width = 7, height = 3)

```

Now rmANOVA on reproduction biases, CTI and general biases

```{r rmANOVA_encoding, message=FALSE, warning=FALSE}
# rmANOVA on reproduction biases
av1 = mRep %>% filter(ExpName == 'Encoding') %>% 
  ezANOVA(dv = m_bias, wid = NSub, within = .(DurLevel, Load), detailed = TRUE) %>%
  calParEta2()
print(av1)
print(GGcr(av1))

#rmANOVA on cti
av2 = mRep_cti %>% filter(ExpName == 'Encoding') %>% 
  ezANOVA(dv = cti, wid = NSub, within = Load, detailed = TRUE) %>%
  calParEta2()
print(av2)

#rmANOVA on general bias
av3 = mBias %>% filter(ExpName == 'Encoding') %>% 
  ezANOVA(dv = ms_bias, wid = NSub, within = Load, detailed = TRUE) %>%
  calParEta2()
print(av3)

# rmANOVA on cv
av4 = mRep %>% filter(ExpName == 'Encoding') %>% 
  ezANOVA(dv = cv, wid = NSub, within = .(DurLevel, Load), detailed = TRUE) %>%
  calParEta2()
print(av4)
print(GGcr(av4))

```

```{r}
# given the significance of memory load on general bias, we further conduct post hoc pairwise t-test
mRep_cti %>% filter(ExpName == 'Encoding')  -> cti_encd
pairwise.t.test(x = cti_encd$cti, g = cti_encd$Load, paired = TRUE, p.adjust.method = 'holm')

```

```{r}
# rmANOVA on working memory task accuracy
mWM %>% filter(ExpName == 'Encoding') %>% group_by(Load) %>% summarise(mean(m_WMCrr), sd(m_WMCrr)/sqrt(n()))
mWM %>% filter(ExpName == 'Encoding') %>% 
  ezANOVA(dv = m_WMCrr, wid = NSub, within = Load, detailed = TRUE) %>%
  calParEta2() -> avm
print(avm)

```

# 2. Working memory impacts on the reproduction phase

```{r plotfigs2, message=FALSE, warning=FALSE}
# reproduction manipulation
fig_reproduction = plot_fig('Reproduction', subfig = TRUE)
fig_reproduction$fig_c = fig_reproduction$fig_c +
  geom_signif(y_position = c(130, 145), xmin = c(1,1), xmax = c(2, 3), 
              annotation = c("*", "***"), vjust = 0.5) + 
  scale_y_reverse()
fig_rp = plot_grid(fig_reproduction$fig_b, fig_reproduction$fig_c, 
                   labels = c('a', 'b'))
fig_rp
# save figures
ggsave("./figures/fig_reproduction.png", fig_rp, width = 7, height = 3)

```

Now rmANOVA on reproduction biases, CTI and general biases

```{r rmANOVA_reproduction, message=FALSE, warning=FALSE}
# rmANOVA on reproduction biases
av1 = mRep %>% filter(ExpName == 'Reproduction') %>% 
  ezANOVA(dv = m_bias, wid = NSub, within = .(DurLevel, Load), detailed = TRUE) %>%
  calParEta2()
print(av1)
print(GGcr(av1))

#rmANOVA on cti
av2 = mRep_cti %>% filter(ExpName == 'Reproduction') %>% 
  ezANOVA(dv = cti, wid = NSub, within = Load, detailed = TRUE) %>%
  calParEta2()
print(av2)

#rmANOVA on general bias
av3 = mBias %>% filter(ExpName == 'Reproduction') %>% 
  ezANOVA(dv = ms_bias, wid = NSub, within = Load, detailed = TRUE) %>%
  calParEta2()
print(av3)

# rmANOVA on cv
av4 = mRep %>% filter(ExpName == 'Reproduction') %>% 
  ezANOVA(dv = cv, wid = NSub, within = .(DurLevel, Load), detailed = TRUE) %>%
  calParEta2()
print(av4)

```

```{r}
# given the significance of memory load on general bias, we further conduct post hoc pairwise t-test
mBias %>% filter(ExpName == 'Reproduction')  -> mBias_rp
pairwise.t.test(x = mBias_rp$ms_bias, g = mBias_rp$Load, paired = TRUE, p.adjust.method = 'holm')

```

```{r}
# rmANOVA on working memory task accuracy
mWM %>% filter(ExpName == 'Reproduction') %>% group_by(Load) %>% summarise(mean(m_WMCrr), sd(m_WMCrr)/sqrt(n()))
mWM %>% filter(ExpName == 'Reproduction') %>% 
  ezANOVA(dv = m_WMCrr, wid = NSub, within = Load, detailed = TRUE) %>%
  calParEta2() -> avm
print(avm)

# Post hoc pairwise t-test on WM accuracy
mWM %>% filter(ExpName == 'Reproduction')  -> mWM_rp
pairwise.t.test(x = mWM_rp$m_WMCrr, g = mWM_rp$Load, paired = TRUE, p.adjust.method = 'holm')

```


# 3. working memory after duration task (baseline: no memory load)

```{r plotfigs2, message=FALSE, warning=FALSE}
# reproduction manipulation
fig_baseline = plot_fig('Baseline', subfig = TRUE)
fig_baseline$fig_c = fig_baseline$fig_c + scale_y_reverse()

fig_bs = plot_grid(fig_baseline$fig_b, fig_baseline$fig_c, 
                   labels = c('a', 'b'))
fig_bs
# save figures
ggsave("./figures/fig_baseline.png", fig_bs, width = 7, height = 3)

```

Now rmANOVA on reproduction biases, CTI and general biases

```{r rmANOVA_reproduction, message=FALSE, warning=FALSE}
# rmANOVA on reproduction biases
av1 = mRep %>% filter(ExpName == 'Baseline') %>% 
  ezANOVA(dv = m_bias, wid = NSub, within = .(DurLevel, Load), detailed = TRUE) %>%
  calParEta2()
print(av1)
print(GGcr(av1))

#rmANOVA on cti
av2 = mRep_cti %>% filter(ExpName == 'Baseline') %>% 
  ezANOVA(dv = cti, wid = NSub, within = Load, detailed = TRUE) %>%
  calParEta2()
print(av2)

#rmANOVA on general bias
av3 = mBias %>% filter(ExpName == 'Baseline') %>% 
  ezANOVA(dv = ms_bias, wid = NSub, within = Load, detailed = TRUE) %>%
  calParEta2()
print(av3)

# rmANOVA on cv
av4 = mRep %>% filter(ExpName == 'Baseline') %>% 
  ezANOVA(dv = cv, wid = NSub, within = .(DurLevel, Load), detailed = TRUE) %>%
  calParEta2()
print(av4)
```

```{r}
# mean CTI values
mRep_cti %>% filter(ExpName == 'Baseline') %>% group_by(Load) %>% summarise(mean(cti), sd(cti)/sqrt(n()))

```

```{r}
# rmANOVA on working memory task accuracy
mWM %>% filter(ExpName == 'Baseline') %>% group_by(Load) %>% summarise(mean(m_WMCrr), sd(m_WMCrr)/sqrt(n()))
mWM %>% filter(ExpName == 'Baseline') %>% 
  ezANOVA(dv = m_WMCrr, wid = NSub, within = Load, detailed = TRUE) %>%
  calParEta2() -> avm
print(avm)
print(GGcr(avm))

# Post hoc pairwise t-test on WM accuracy
mWM %>% filter(ExpName == 'Baseline')  -> mWM_bl
pairwise.t.test(x = mWM_bl$m_WMCrr, g = mWM_bl$Load, paired = TRUE, p.adjust.method = 'holm')

```


# 4. Working memory on both encoding and reproduction phases
```{r plotfigs3, message=FALSE, warning=FALSE}
# both manipulation
fig_both = plot_fig('Both', subfig = TRUE)
fig_both$fig_b = fig_both$fig_b + 
  geom_signif(y_position = c(0.6, 0.65), xmin = c(1,2), xmax = c(2, 3), 
              annotation = c("**", "**")) + ylim(0, 0.7)
fig_both$fig_c = fig_both$fig_c + 
  geom_signif(y_position = c(130, 145), xmin = c(1,1), xmax = c(2, 3), 
              annotation = c("*", "*"), vjust=0.5) + ylim(-150,0) + 
  scale_y_reverse()

fig_bt = plot_grid(fig_both$fig_b, fig_both$fig_c, 
                   labels = c('a', 'b'))
fig_bt
# save figures
ggsave("./figures/fig_both.png", fig_bt, width = 7, height = 3)

```

ANOVAs on reproduction biases, CTI and general biases

```{r rmANOVA_both, message=FALSE, warning=FALSE}
# rmANOVA on reproduction biases
av1 = mRep %>% filter(ExpName == 'Both') %>% 
  ezANOVA(dv = m_bias, wid = NSub, within = .(DurLevel, Load), detailed = TRUE) %>%
  calParEta2()
print(av1)
print(GGcr(av1))

#rmANOVA on cti
av2 = mRep_cti %>% filter(ExpName == 'Both') %>% 
  ezANOVA(dv = cti, wid = NSub, within = Load, detailed = TRUE) %>%
  calParEta2()
print(av2)

#rmANOVA on general bias
av3 = mBias %>% filter(ExpName == 'Both') %>% 
  ezANOVA(dv = ms_bias, wid = NSub, within = Load, detailed = TRUE) %>%
  calParEta2()
print(av3)

# rmANOVA on cv 
av4 = mRep %>% filter(ExpName == 'Both') %>% 
  ezANOVA(dv = cv, wid = NSub, within = .(DurLevel, Load), detailed = TRUE) %>%
  calParEta2()
print(av4)
print(GGcr(av4))

```


```{r posthoc_both, message=FALSE, warning=FALSE}
# Post hoc pairwise t-test on general bias
mBias %>% filter(ExpName == 'Both') %>% group_by(Load) %>% summarise(mean(ms_bias), sd(ms_bias)/sqrt(n()))
mBias %>% filter(ExpName == 'Both')  -> mBias_bt
pairwise.t.test(x = mBias_bt$ms_bias, g = mBias_bt$Load, paired = TRUE, p.adjust.method = 'holm')

# Post hoc pairwise t-test on cti
mRep_cti %>% filter(ExpName == 'Both')  -> mRep_cti_bt
pairwise.t.test(x = mRep_cti_bt$cti, g = mRep_cti_bt$Load, paired = TRUE, p.adjust.method = 'holm')

```


```{r}
# ANOVA on working memory accuracy
mWM %>% filter(ExpName == 'Both') %>% group_by(Load) %>% summarise(mean(m_WMCrr), sd(m_WMCrr)/sqrt(n()))
mWM %>% filter(ExpName == 'Both') %>% 
  ezANOVA(dv = m_WMCrr, wid = NSub, within = Load, detailed = TRUE) %>%
  calParEta2() -> avm
print(avm)

# post hoc pairwise t-test on WM accuracy
mWM %>% filter(ExpName == 'Both')  -> mWM_both
pairwise.t.test(x = mWM_both$m_WMCrr, g = mWM_both$Load, paired = TRUE, p.adjust.method = 'holm')

```

```{r, message=FALSE, warning=FALSE, include=FALSE}
# Previously, it observed a reduction of central tendency at high load. To further
# explore if this is a general fashion or driven by certain outliers, here plot 
# reproduction bias, CTI, and WM accuracy performance for each participant.
bias_exp4_par <- mRep %>% filter(ExpName=='Both') %>%
  group_by(curDur,Load,NSub) %>% summarise(mBias=mean(m_bias))
fig_exp4_par <- ggplot(data=bias_exp4_par, aes(curDur,mBias,color=Load)) + 
  geom_point() + geom_line() +
  facet_wrap(~NSub) +
  theme_new
fig_exp4_par

cti_exp4_par <- mRep_cti %>% filter(ExpName == 'Both') %>%
  group_by(Load,NSub) %>% summarise(mCTI=mean(cti))
fig2_exp4_par <- ggplot(data=cti_exp4_par, aes(Load,mCTI)) + 
  geom_bar(stat = 'identity', width = 0.75) + 
  facet_wrap(~NSub) +
  theme_new
fig2_exp4_par

mwm_exp4_par <- mWM %>% filter(ExpName=='Both') %>% 
  group_by(WMSize,NSub) %>% summarise(mWM=mean(m_WMCrr))
fig3_exp4_par <- ggplot() + 
  geom_bar(data=cti_exp4_par, aes(Load,mCTI),stat='identity',width=0.75) + 
  geom_line(data=mwm_exp4_par, aes(WMSize,mWM)) +
  geom_point(size = 2, stat = 'identity') + 
  facet_wrap(~NSub) +
  theme_new
fig3_exp4_par

```

# [*1] cross-experiment analysis and figures

## cross-Exp. (Exp1-4) analysis on working memory accuracy
```{r posthoc_both_cti, message=FALSE, warning=FALSE}
# combined accuracy data from Exp1-4
mWM %>% filter(ExpName=='Encoding' | ExpName=='Reproduction'|
                         ExpName=='Baseline'| ExpName=='Both') %>% 
  group_by(ExpName, Load) -> wmCrsExp

# ANOVA
wmCrsExp %>% mutate(ExpName = as.factor(ExpName)) %>%
  ezANOVA(dv = m_WMCrr, wid = NSub, within = Load, between=ExpName, detailed = TRUE) %>%
  calParEta2() -> avmCrsExp
print(avmCrsExp)

# post hoc tests
pairwise.t.test(x = wmCrsExp$m_WMCrr, g = wmCrsExp$ExpName, paired = FALSE, p.adjust.method = 'holm')
pairwise.t.test(x = wmCrsExp$m_WMCrr, g = wmCrsExp$Load, paired = TRUE, p.adjust.method = 'holm')

# mean accuracy values for each exp.
mWM %>% filter(ExpName=='Encoding' | ExpName=='Reproduction'| 
                 ExpName=='Baseline'| ExpName=='Both') %>%
  group_by(ExpName) %>% summarise(mean(m_WMCrr), sd(m_WMCrr)/sqrt(n()))

# save mean accuracy data for each participant
mWMCrsExpLongTab = 
  subset(mWM %>% filter(ExpName=='Encoding' | ExpName=='Reproduction'|
                        ExpName=='Baseline'| ExpName=='Both'), 
               select=c(ExpName, Load, NSub, m_WMCrr)) %>% 
    pivot_wider(names_from = c("Load"), 
                values_from = c(m_WMCrr), names_sep="_")
#write.csv(mWMCrsExpLongTab,paste0(getwd(),"/bhvrlt/mWMCrsExpLongTab.csv"))

```

## plot mean and cv of bias for Exps 1-4
```{r plotfigs1to4, message=FALSE, warning=FALSE}
# manipulation with encoding, reproduction and baseline in sub-experiments 6a-c
ExpName.labs <- c("Exp. 1 (Encoding)","Exp. 2 (Reproduction)",
                  "Exp. 3 (Baseline)","Exp. 4 (Both)")
names(ExpName.labs) <- c("Encoding", "Reproduction", "Baseline","Both")
tmp <- mRep %>% filter(ExpName=='Encoding' | ExpName=='Reproduction'|
                         ExpName=='Baseline'| ExpName=='Both')
# adjust order of labels
tmp$ExpName2 = factor(tmp$ExpName, levels=c("Encoding", "Reproduction",
                                            "Baseline", "Both")) 
fig_a4e = tmp %>% group_by(Load, curDur, ExpName2) %>% 
  summarise(mm_bias = mean(m_bias), se_bias = sd(m_bias)/sqrt(n())) %>%
  ggplot(aes(curDur, mm_bias,  color = Load, shape = Load)) + 
    geom_point(size = 2, stat = 'identity') + geom_line() + 
    geom_errorbar(aes(ymin = mm_bias - se_bias, 
                      ymax = mm_bias + se_bias), width = 0.05) +
    coord_cartesian(ylim = c(-0.5, 0.3)) +
    scale_x_continuous(breaks=c(0.5, 0.8, 1.1, 1.4, 1.7)) +
    geom_hline(yintercept = 0, linetype = "dashed", color = "darkgrey") +
    labs(x="", y="Reproduction bias (s)", 
       shape ="Memory Load", color = "Memory Load") +
    facet_grid(~ExpName2, labeller = labeller(ExpName2 = ExpName.labs))+
    theme_new + greySet3 +   theme(legend.position = c(.9,.8), 
        legend.text = element_text(size = 10), 
        legend.title = element_text(size = 10, face = "bold"),
        plot.title = element_text(hjust = 0.5))
fig_a4e
fig_cv4e = tmp %>% group_by(Load, curDur, ExpName2) %>% 
  summarise(m_cv = mean(cv), se_cv = sd(cv)/sqrt(n())) %>%
    ggplot(aes(curDur, m_cv, color = Load, shape = Load)) + 
    geom_point(size = 2, stat = 'identity') + geom_line() + 
    geom_errorbar(aes(ymin = m_cv - se_cv, ymax = m_cv + se_cv), width = 0.05) +
    scale_x_continuous(breaks=c(0.5, 0.8, 1.1, 1.4, 1.7)) +
    coord_cartesian(ylim = c(0.165, 0.34)) + 
    scale_y_continuous(breaks=c(0.16, 0.2, 0.24, 0.28, 0.32)) +
    labs(x="Durations (s)", y="CV", shape ="Memory Load", color = "Memory Load") +
    facet_grid(~ExpName2, labeller = labeller(ExpName2 = ExpName.labs))+
    theme_new + greySet3 + theme(legend.position = "none", 
                                 strip.text.x = element_blank())
fig_cv4e
# combine figures
fig_4e = ggarrange(fig_a4e, fig_cv4e, labels=c('a','b'), heights= c(4,3),
                    nrow = 2, common.legend = TRUE, legend = c("top"))
fig_4e
# save figure
ggsave("./figures/fig2_Exp1to4.png", fig_4e, width = 7, height = 5)

```

## compare CTI of Exps 1 & 4
```{r, message=FALSE, warning=FALSE}
# combined CTI from Exp1 & 4
mRep_cti %>% filter(ExpName=='Encoding'| ExpName=='Both') %>% 
  group_by(ExpName, Load) -> ctiCrsExp

ctiCrsExp %>% mutate(ExpName = as.factor(ExpName)) %>%
  ezANOVA(dv = cti, wid = NSub, within = Load, between=ExpName, detailed = TRUE) %>%
  calParEta2() -> avCtiCrsExp
print(avCtiCrsExp)

# post hoc tests
pairwise.t.test(x = ctiCrsExp$cti, g = ctiCrsExp$ExpName, paired = FALSE, p.adjust.method = 'holm')
pairwise.t.test(x = ctiCrsExp$cti, g = ctiCrsExp$Load, paired = TRUE, p.adjust.method = 'holm')

# mean accuracy values for each exp.
mRep_cti %>% filter(ExpName=='Encoding' | ExpName=='Both') %>%
  group_by(ExpName) %>% summarise(mean(cti), sd(cti)/sqrt(n()))


# save cti for each participant
mCtiCrsExpLongTab = 
  subset(mRep_cti %>% filter(ExpName=='Encoding'| ExpName=='Both'), 
               select=c(ExpName, Load, NSub, cti)) %>% 
    pivot_wider(names_from = c("Load"), 
                values_from = c(cti), names_sep="_")
# write.csv(mCtiCrsExpLongTab,paste0(getwd(),"/bhvrlt/mCtiCrsExpLongTab.csv"))

# combine figures
fig_4b = ggarrange(fig_encoding$fig_b, fig_both$fig_b, 
                   labels=c('a','b','c','d'), 
                   nrow = 1, common.legend = TRUE, legend = c("top"))
fig_4b
```


# 5. Working memory on both encoding and reproduction phases with gap

```{r plotfigs4, message=FALSE, warning=FALSE}
# both manipulation with gap
fig_a = mRep %>% filter(ExpName == 'Both_gap', gap == 1) %>% plot_cti() + 
  #add text 'Short Gap' on the left top
  geom_text(aes(x = 0.8, y = 0.5, label='Short Gap'), size=3, color='black')
fig_b = mRep_cti %>% filter(ExpName == 'Both_gap', gap==1) %>% plot_cti_Load() +
  geom_signif(y_position = c(0.55, 0.65), xmin = c(1,1), xmax = c(2, 3), 
              annotation = c("*", "*")) + ylim(0, 0.7)
fig_c = mBias %>% filter(ExpName == 'Both_gap', gap==1) %>% plot_bias_Load() + 
  geom_signif(y_position = c(145), xmin = c(1), xmax = c(2), annotation=c("*"))
fig_cv = mRep %>% filter(ExpName == 'Both_gap', gap == 1) %>% plot_cv() +
  coord_cartesian(ylim = c(0.15, 0.30)) + 
  scale_y_continuous(breaks=c(0.16, 0.2, 0.24, 0.28))

fig_a2 = mRep %>% filter(ExpName == 'Both_gap', gap == 2) %>% plot_cti() + 
    geom_text(aes(x = 0.8, y = 0.5, label='Long Gap'), size=3, color='black') +
    theme(legend.position = "none") # remove legend
fig_b2 = mRep_cti %>% filter(ExpName=='Both_gap', gap==2) %>% plot_cti_Load() + 
  geom_signif(y_position = c(0.6, 0.7), xmin = c(1,1), xmax = c(2, 3), 
              annotation = c("*", "*")) + ylim(0, 0.8)
fig_c2 = mBias %>% filter(ExpName == 'Both_gap', gap==2) %>% plot_bias_Load()  + 
  geom_signif(y_position = c(160, 175), xmin = c(1,1), xmax = c(2, 3), 
              annotation = c("**", "**"))
fig_cv2 = mRep %>% filter(ExpName == 'Both_gap', gap == 2) %>% plot_cv() +
  coord_cartesian(ylim = c(0.175, 0.30)) + 
  scale_y_continuous(breaks=c(0.2, 0.24, 0.28))

# combine figures
fig_gap = plot_grid(fig_a, fig_b, fig_cv, fig_c, fig_a2, fig_b2, fig_cv2, fig_c2, 
                    labels = c('a', 'b', 'c', 'd', 'e', 'f', 'g', 'h'), nrow = 4)
fig_gap
# save figure
#ggsave("./figures/fig_gap.png", fig_gap, width = 7, height = 10)

```

```{r plotfigs4, message=FALSE, warning=FALSE}
# an alternative figure of plotting short and long gap conditions together
###############################
gap.labs <- c("Short Gap","Long Gap")
names(gap.labs) <- c(1, 2)
mRep$gap = as.factor(mRep$gap)
fig_a = mRep %>% filter(ExpName == 'Both_gap') %>% 
  group_by(Load, curDur, gap) %>% 
  summarise(mm_bias = mean(m_bias), se_bias = sd(m_bias)/sqrt(n())) %>%
  ggplot(aes(curDur, mm_bias, group=interaction(Load,gap), 
             color=Load, shape=Load)) +
  geom_point(size = 2, stat = 'identity') + geom_line() + 
  geom_errorbar(aes(ymin = mm_bias-se_bias, ymax = mm_bias+se_bias), width=0.05) +
  coord_cartesian(ylim = c(-0.45, 0.2)) +
  scale_x_continuous(breaks=c(0.5, 0.8, 1.1, 1.4, 1.7)) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "darkgrey") +
  labs(x="", y="Reproduction bias (s)", 
     shape ="Memory Load", color = "Memory Load") +
  facet_grid(~gap, labeller = labeller(gap = gap.labs)) +
  theme_new + greySet3 + theme(legend.position = c(.9,.8), 
      legend.text = element_text(size = 10), 
      legend.title = element_text(size = 10, face = "bold"),
      plot.title = element_text(hjust = 0.5))

mRep_cti$gap = as.factor(mRep_cti$gap)
fig_b = mRep_cti %>% filter(ExpName == 'Both_gap') %>% group_by(Load, gap) %>% 
  summarise(m_cti = mean(cti), se_cti = sd(cti)/sqrt(n())) %>%
  ggplot(aes(gap, m_cti, group=interaction(Load, gap), fill = Load)) + 
  geom_bar(stat = 'identity', width = 0.75, position=position_dodge(.8)) + 
  geom_errorbar(aes(ymin = m_cti - se_cti, ymax = m_cti + se_cti, 
                    color = Load), width = 0.3, position=position_dodge(.8)) +
  coord_cartesian(ylim = c(0.1, 0.8)) +
  scale_x_discrete(labels=c("Short Gap", "Long Gap")) +
  geom_signif(y_position = c(0.54,0.62,0.56,0.64,0.75), xmin = c(0.74,0.74,1.74,1.74,1), 
              xmax = c(1,1.26,2,2.26,2), annotation = c("*","*","*","*","***")) +
  labs(x="", y="CTI", fill = "Memory Load", color = "Memory Load") +
  theme_new + fillGreySet3 + greySet3 + theme(legend.position = "none", 
      plot.title = element_text(hjust = 0.5))

fig_cv = mRep %>% filter(ExpName == 'Both_gap') %>% 
  group_by(Load, curDur, gap) %>% 
  summarise(m_cv = mean(cv), se_cv = sd(cv)/sqrt(n())) %>%
  ggplot(aes(curDur, m_cv, group=interaction(Load,gap), color=Load, shape=Load)) + 
  geom_point(size = 2, stat = 'identity') + geom_line() + 
  geom_errorbar(aes(ymin = m_cv - se_cv, ymax = m_cv + se_cv), width = 0.05) +
  scale_x_continuous(breaks=c(0.5, 0.8, 1.1, 1.4, 1.7)) +
  coord_cartesian(ylim = c(0.15, 0.30)) + 
  scale_y_continuous(breaks=c(0.16, 0.2, 0.24, 0.28)) +
  labs(x="Durations (s)", y="CV", shape ="Memory Load", color = "Memory Load") +
  facet_grid(~gap, labeller = labeller(gap = gap.labs)) +
  theme_new + greySet3 + theme(legend.position = "none", 
                               strip.text.x = element_blank())

mBias$gap = as.factor(mBias$gap)
fig_c = mBias %>% filter(ExpName == 'Both_gap') %>% group_by(Load, gap) %>% 
  summarise(bias = mean(ms_bias), se_bias = sd(ms_bias)/sqrt(n())) %>%
  ggplot(aes(gap, bias, group=interaction(Load, gap), fill = Load)) + 
  geom_bar(stat = 'identity', width = 0.75, position=position_dodge(.8)) + 
  geom_errorbar(aes(ymin = bias - se_bias, ymax = bias + se_bias, 
                    color = Load), width = 0.3, position=position_dodge(.8)) +
  scale_y_reverse() + coord_cartesian(ylim = c(-20, -180)) +
  scale_x_discrete(labels=c("Short Gap", "Long Gap")) +
  geom_signif(y_position = c(145,155,175), xmin = c(0.74,1.74,1.74), 
              xmax = c(1,2,2.26), annotation = c("*","**","**")) +
  labs(x="", y="Mean Bias (ms)", fill = "Memory Load", color='Memory Load') +
  theme_new + fillGreySet3 + greySet3 + theme(legend.position = "none", 
      plot.title = element_text(hjust = 0.5))

# combine figures
fig_gap1 = ggarrange(fig_a, fig_b, fig_cv, fig_c, labels=c('a','b','c','d'),
                    ncol=2, nrow = 2, widths = c(4.1,2.9), heights= c(4,3.5),
                    common.legend = TRUE, legend = c("top"))
fig_gap1

#fig_gap2 = ggarrange(fig_b, fig_c, labels=c('a','b'))
#fig_gap2

# save figure
ggsave("./figures/fig_gap_compact.png", fig_gap1, width = 7, height = 5)
#ggsave("./figures/fig_gap_compact2.png", fig_gap2, width = 7, height = 3)
```

ANOVAs on reproduction biases, CTI and general biases

```{r rmANOVA_gap, message=FALSE, warning=FALSE}
# rmANOVA on reproduction biases
av1 = mRep %>% filter(ExpName == 'Both_gap') %>% mutate(gap = as.factor(gap)) %>%
  ezANOVA(dv = m_bias, wid = NSub, within = .(DurLevel, Load, gap), detailed = TRUE) %>%
  calParEta2()
print(av1)
print(GGcr(av1))
# short gap
av1_short = mRep %>% filter(ExpName == 'Both_gap', gap==1) %>% mutate(gap = as.factor(gap)) %>%
  ezANOVA(dv = m_bias, wid = NSub, within = .(DurLevel, Load), detailed = TRUE) %>%
  calParEta2()
print(av1_short)
print(GGcr(av1_short))
# long gap
av1_long = mRep %>% filter(ExpName == 'Both_gap', gap==2) %>% mutate(gap = as.factor(gap)) %>%
  ezANOVA(dv = m_bias, wid = NSub, within = .(DurLevel, Load), detailed = TRUE) %>%
  calParEta2()
print(av1_long)
print(GGcr(av1_long))

#rmANOVA on cti
av2 = mRep_cti %>% filter(ExpName == 'Both_gap') %>%mutate(gap = as.factor(gap)) %>%
  ezANOVA(dv = cti, wid = NSub, within = .(Load, gap), detailed = TRUE) %>%
  calParEta2()
print(av2)

#rmANOVA on general bias
av3 = mBias %>% filter(ExpName == 'Both_gap') %>% mutate(gap = as.factor(gap)) %>%
  ezANOVA(dv = ms_bias, wid = NSub, within = .(Load, gap), detailed = TRUE) %>%
  calParEta2()
print(av3)
print(GGcr(av3))

# rmANOVA on cv 
av4 = mRep %>% filter(ExpName == 'Both_gap') %>% mutate(gap = as.factor(gap)) %>%
  ezANOVA(dv = cv, wid = NSub, within = .(DurLevel, Load, gap), detailed = TRUE) %>%
  calParEta2()
print(av4)
print(GGcr(av4))
# short gap
av4_short = mRep %>% filter(ExpName == 'Both_gap', gap==1) %>%
  ezANOVA(dv = cv, wid = NSub, within = .(DurLevel, Load), detailed = TRUE) %>%
  calParEta2()
print(av4_short)
print(GGcr(av4_short))
# long gap
av4_long = mRep %>% filter(ExpName == 'Both_gap', gap==2) %>% 
  ezANOVA(dv = cv, wid = NSub, within = .(DurLevel, Load), detailed = TRUE) %>%
  calParEta2()
print(av4_long)
print(GGcr(av4_long))
```


Post hoc pairwise t-test on cti

```{r posthoc_both_cti, message=FALSE, warning=FALSE}
# load effect of cti on short and long gap
mRep_cti %>% filter(ExpName == 'Both_gap', gap==1)  -> mRep_cti_gap1
pairwise.t.test(x = mRep_cti_gap1$cti, g = mRep_cti_gap1$Load, paired = TRUE, p.adjust.method = 'holm')

mRep_cti %>% filter(ExpName == 'Both_gap', gap==2)  -> mRep_cti_gap2
pairwise.t.test(x = mRep_cti_gap2$cti, g = mRep_cti_gap2$Load, paired = TRUE, p.adjust.method = 'holm')

# gap effect of cti
mRep_cti %>% filter(ExpName == 'Both_gap')  -> mRep_cti_gap
pairwise.t.test(x = mRep_cti_gap$cti, g = mRep_cti_gap$gap, paired = TRUE, p.adjust.method = 'holm')

mRep_cti %>% filter(ExpName == 'Both_gap') %>% group_by(gap) %>% 
  summarise(m_cti = mean(cti), se_cti = sd(cti)/sqrt(n()), n = n()) 
```


Post hoc pairwise t-test on mean bias

```{r posthoc_both_meanBias, message=FALSE, warning=FALSE}
# load effect of mean bias on short and long gap
mBias %>% filter(ExpName == 'Both_gap', gap==1)  -> mRep_mb_gap1
pairwise.t.test(x = mRep_mb_gap1$ms_bias, g = mRep_mb_gap1$Load, paired = TRUE, p.adjust.method = 'holm')

mRep_mb_gap1 %>% group_by(Load) %>% 
  summarise(msBias = mean(ms_bias), seBias = sd(ms_bias)/sqrt(n()), n = n())

mBias %>% filter(ExpName == 'Both_gap', gap==2)  -> mRep_mb_gap2
pairwise.t.test(x = mRep_mb_gap2$ms_bias, g = mRep_mb_gap2$Load, paired = TRUE, p.adjust.method = 'holm')

```

Post hoc pairwise t-test on cv bias

```{r posthoc_both_meanBias, message=FALSE, warning=FALSE}
mRep %>% filter(ExpName == 'Both_gap') %>% group_by(Load) %>% summarise(m_cv = mean(cv), n = n())
mRep %>% filter(ExpName == 'Both_gap') %>% group_by(NSub, Load) %>% 
  summarise(m_cv = mean(cv), n = n()) -> mcv_wm
pairwise.t.test(x = mcv_wm$m_cv, g = mcv_wm$Load, paired = TRUE, p.adjust.method = 'holm')

mRep %>% filter(ExpName == 'Both_gap', gap==1) %>% group_by(NSub, Load) %>% 
  summarise(m_cv = mean(cv), n = n()) -> mcv_wm_gap1
pairwise.t.test(x = mcv_wm_gap1$m_cv, g = mcv_wm_gap1$Load, paired = TRUE, p.adjust.method = 'holm')

mRep %>% filter(ExpName == 'Both_gap', gap==2) %>% group_by(NSub, Load) %>% 
  summarise(m_cv = mean(cv), n = n()) -> mcv_wm_gap2
pairwise.t.test(x = mcv_wm_gap2$m_cv, g = mcv_wm_gap2$Load, paired = TRUE, p.adjust.method = 'holm')

mRep %>% filter(ExpName == 'Both_gap') %>% group_by(gap) %>% summarise(m_cv = mean(cv), n = n())
mRep %>% filter(ExpName == 'Both_gap') %>% group_by(NSub,gap) %>% 
  summarise(m_cv = mean(cv), n = n()) -> mcv_gap
pairwise.t.test(x = mcv_gap$m_cv, g = mcv_gap$gap, paired = TRUE, p.adjust.method = 'holm')
```


```{r}
# ANOVA on WM accuracy
mWM %>% filter(ExpName == 'Both_gap') %>% mutate(gap = as.factor(gap)) %>%
  ezANOVA(dv = m_WMCrr, wid = NSub, within = .(Load, gap), detailed = TRUE) %>%
  calParEta2() -> avm
print(avm)

# post hoc pairwise t-test
mWM %>% filter(ExpName == 'Both_gap')  -> mWM_both_gap
pairwise.t.test(x = mWM_both_gap$m_WMCrr, g = mWM_both_gap$Load, paired = TRUE, p.adjust.method = 'holm')

# mean accuracy values
mWM %>% filter(ExpName == 'Both_gap') %>% group_by(Load) %>% summarise(mean(m_WMCrr), sd(m_WMCrr)/sqrt(n()))
mWM %>% filter(ExpName == 'Both_gap') %>% group_by(gap) %>% summarise(mean(m_WMCrr), sd(m_WMCrr)/sqrt(n()))

```


# [*2] cross-experiment analysis and figures

## cross-exp. (Exp 4 vs 5) analysis of WM accuracy
```{r}
# Effect of Experiment (4 vs 5)
mWM_exp45 <- mWM %>% filter(ExpName == 'Both_gap' | ExpName == 'Both')
mWM_exp45 %>% group_by(ExpName) %>% summarise(mWMs=mean(m_WMCrr), seWMs=sd(m_WMCrr)/sqrt(n()))
mWM_exp45 %>% mutate(gap = as.factor(gap)) %>%
  ezANOVA(dv = m_WMCrr, wid = NSub, between=ExpName, detailed = TRUE) %>%
  calParEta2() -> anv_exp45
print(anv_exp45)

# Effect of Experiment (4 vs 5_short_gap)
mWM_exp45 %>% group_by(ExpName,gap) %>% summarise(mWMs=mean(m_WMCrr), seWMs=sd(m_WMCrr)/sqrt(n()))
mWM_exp45 %>% filter(gap==1) %>% mutate(gap = as.factor(gap)) %>%
  ezANOVA(dv = m_WMCrr, wid = NSub, between=ExpName, detailed = TRUE) %>%
  calParEta2() -> anv_exp45_gap
print(anv_exp45_gap)

```

## cross-exp. (Exp1-6) plots of WM accuracy
```{r}
# visualize the WM accuracy for Exps1-4
mWM_exps1 <- mWM %>% 
  filter(ExpName=='Encoding'|ExpName=='Reproduction'|
           ExpName=='Both'|ExpName=='Baseline') %>% 
  group_by(ExpName,WMSize,gap) %>%
  summarise(mnWM=mean(m_WMCrr), seWM=sd(m_WMCrr)/sqrt(n()),n=n())
fig_wm1 <- ggplot(data=mWM_exps1, aes(WMSize,mnWM,color=ExpName)) + geom_point() + geom_line() +
  geom_errorbar(aes(ymin=mnWM-seWM, ymax=mnWM+seWM), width=0.1) + 
  coord_cartesian(ylim = c(0.55, 0.95)) +
  theme_new + theme(legend.position = c(.8,.8))
fig_wm1

# visualize the WM accuracy for Exp4 vs 5
mWM_exps2 <- mWM %>% 
  filter(ExpName=='Both'|ExpName=='Both_gap') %>% mutate(gap = as.factor(gap)) %>%
  group_by(ExpName,WMSize,gap) %>%
  summarise(mnWM=mean(m_WMCrr), seWM=sd(m_WMCrr)/sqrt(n()),n=n())
fig_wm2 <- ggplot(data=mWM_exps2, aes(WMSize,mnWM,color=ExpName,linetype=gap)) + geom_point() + 
  geom_line() + geom_errorbar(aes(ymin=mnWM-seWM, ymax=mnWM+seWM), width=0.1) +
  coord_cartesian(ylim = c(0.55, 0.95)) +
  theme_new + theme(legend.position = c(.8,.8))
fig_wm2

# visualize the WM accuracy for Exp6a-c
mWM_exps3 <- mWM %>% 
  filter(ExpName=='Encoding2'|ExpName=='Reproduction2'|
           ExpName=='baseline2') %>% 
  group_by(ExpName,WMSize) %>%
  summarise(mnWM=mean(m_WMCrr), seWM=sd(m_WMCrr)/sqrt(n()),n=n())
fig_wm3 <- ggplot(data=mWM_exps3, aes(WMSize,mnWM,color=ExpName)) + geom_point() + geom_line() +
  geom_errorbar(aes(ymin=mnWM-seWM, ymax=mnWM+seWM), width=0.1) +
  coord_cartesian(ylim = c(0.55, 0.95)) +
  theme_new + theme(legend.position = c(.8,.8))
fig_wm3

fig_wmExps = ggarrange(fig_wm1, fig_wm2, fig_wm3, labels=c('a','b','c'),
                       ncol=3, nrow = 1)
fig_wmExps
#ggsave("./figures/fig_wm_allExps.png", fig_wmExps, width = 10, height = 5)

```

## cross-exp. (Exp1-4 & 5_short_gap) analysis on CV
```{r}
# anova across Exp. 1-4 and 5 (only short gap)
cv_crsExp <- mRep %>% filter(ExpName=='Encoding' | ExpName=='Reproduction'|
                              ExpName=='Baseline'| ExpName=='Both' |
                              ExpName == 'Both_gap', gap != 2)
av_cv_crsExp <- cv_crsExp %>%
  ezANOVA(dv = cv, wid = NSub, within = .(DurLevel, Load), 
          between=ExpName, detailed = TRUE) %>%
  calParEta2()
print(av_cv_crsExp$ANOVA)
print(GGcr(av_cv_crsExp))

# post hoc pairwise t-test
cv_crsExp %>% group_by(NSub,Load,ExpName) %>%
  summarise(m_cv = mean(cv), n = n()) -> mcv_crsExp
pairwise.t.test(x = mcv_crsExp$m_cv, g = mcv_crsExp$Load, paired = TRUE, p.adjust.method = 'holm')

# mean CV values
cv_crsExp %>% group_by(Load) %>% summarise(mean(cv), sd(cv)/sqrt(n()))

```

## cross-Exp. (1,4,5 -- all loaded-on-encoding exps) analysis on CTI
```{r}
# anova across Exp. 1, 4 and 5
cti_crsExp <- mRep_cti %>% filter(ExpName=='Encoding' | ExpName=='Both' |
                              ExpName == 'Both_gap')
av_cti_crsExp <- cti_crsExp %>%
  ezANOVA(dv = cti, wid = NSub, within = Load, between=ExpName, detailed = TRUE) %>%
  calParEta2()
print(av_cti_crsExp)
print(GGcr(av_cti_crsExp))

# post hoc pairwise t-test
cti_crsExp %>% group_by(NSub,Load,ExpName) %>% 
  summarise(m_cti = mean(cti), n = n()) -> mcti_crsExp
pairwise.t.test(x = mcti_crsExp$m_cti, g = mcti_crsExp$Load, paired = TRUE, p.adjust.method = 'holm')

# mean CTI values
cti_crsExp %>% group_by(Load) %>% summarise(mean(cti), sd(cti)/sqrt(n()))

# save CTI for each participant
mCTICrsExpLongTab = 
  subset(cti_crsExp, select=c(ExpName, NSub, Load, cti)) %>% 
  group_by(ExpName,NSub,Load) %>% 
  summarise(m_cti = mean(cti), n = n()) %>% 
  pivot_wider(names_from = c("Load"), values_from = c(m_cti), names_sep="_")
#write.csv(mCTICrsExpLongTab,paste0(getwd(),"/bhvrlt/mCTICrsExpLongTab.csv"))

```


## cross-Exp. (Exp 2 & 6b -- both loaded-on-reproduction exps) analysis on mean Bias 
```{r}
# ANOVA on mean Bias
mB_Rpr <- mBias %>% filter(ExpName == 'Reproduction' | ExpName=='Reproduction2')
av_crsExp = mB_Rpr %>% ezANOVA(dv = ms_bias, wid = NSub, within = Load,
          between=ExpName, detailed = TRUE) %>% calParEta2()
print(av_crsExp)
print(GGcr(av_crsExp))

# plot mean Bias from Exp 2 & 6b together
fig_reproduction2 = plot_fig('Reproduction2', subfig = TRUE)
fig_allRpr = plot_grid(fig_reproduction$fig_c, fig_reproduction2$fig_c, 
                   labels = c('a', 'b'))
fig_allRpr

```

# 6. working memory on encoding, reproduction and baseline (controlling gap)

```{r plot_exp6abc, message=FALSE, warning=FALSE}
# plot Exp 6a, 6b and 6c together
# manipulation with encoding, reproduction and baseline in sub-experiments 6a-c
ExpName.labs <- c("Exp. 6a (Encoding)","Exp. 6b (Reproduction)",
                  "Exp. 6c (Baseline)")
names(ExpName.labs) <- c("Encoding2", "Reproduction2", "baseline2")
tmp <- mRep %>% filter(ExpName=='Encoding2' | ExpName=='Reproduction2'|
                         ExpName=='baseline2')
# adjust order of labels
tmp$ExpName2 = factor(tmp$ExpName, levels=c("Encoding2", "Reproduction2",
                                            "baseline2")) 
fig_a6 = tmp %>% group_by(Load, curDur, ExpName2) %>% 
  summarise(mm_bias = mean(m_bias), se_bias = sd(m_bias)/sqrt(n())) %>%
  ggplot(aes(curDur, mm_bias,  color = Load, shape = Load)) + 
  geom_point(size = 2, stat = 'identity') + geom_line() + 
  geom_errorbar(aes(ymin = mm_bias - se_bias, 
                    ymax = mm_bias + se_bias), width = 0.05) +
  coord_cartesian(ylim = c(-0.35, 0.16)) +
  scale_x_continuous(breaks=c(0.5, 0.8, 1.1, 1.4, 1.7)) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "darkgrey") +
  labs(x="", y="Reproduction bias (s)", 
       shape ="Memory Load", color = "Memory Load") +
  facet_grid(~ExpName2, labeller = labeller(ExpName2 = ExpName.labs))+
  theme_new + greySet3 +   theme(legend.position = c(.9,.8), 
        legend.text = element_text(size = 10), 
        legend.title = element_text(size = 10, face = "bold"),
        plot.title = element_text(hjust = 0.5))

tmp2 <- mRep_cti %>% filter(ExpName=='Encoding2' | ExpName=='Reproduction2'| ExpName=='baseline2')
tmp2$ExpName2 = factor(tmp2$ExpName, levels=c("Encoding2", "Reproduction2", "baseline2"))
fig_b6 = tmp2 %>% group_by(Load, ExpName2) %>% 
  summarise(m_cti = mean(cti), se_cti = sd(cti)/sqrt(n())) %>%
  ggplot(aes(ExpName2, m_cti, group=interaction(Load, ExpName2), fill = Load)) + 
  geom_bar(stat = 'identity', width = 0.75, position=position_dodge(.8)) + 
  geom_errorbar(aes(ymin = m_cti - se_cti, ymax = m_cti + se_cti, 
                    color = Load), width = 0.3, position = position_dodge(.8)) +
  coord_cartesian(ylim = c(0.1, 0.8)) +
  geom_signif(y_position = c(0.55,0.65,0.75), xmin = c(0.74,0.74,1), 
              xmax = c(1,1.26,3), annotation = c("**","**","*")) +
  scale_x_discrete(labels=c('Exp. 6a', 'Exp. 6b', 'Exp. 6c')) +
  labs(x="", y="CTI", fill = "Memory Load", color = "Memory Load") +
  theme_new + fillGreySet3 + greySet3 + theme(legend.position = c(0.85, 0.85), 
      plot.title = element_text(hjust = 0.5))

fig_cv6 = tmp %>% group_by(Load, curDur, ExpName2) %>% 
  summarise(m_cv = mean(cv), se_cv = sd(cv)/sqrt(n())) %>%
  ggplot(aes(curDur, m_cv, color = Load, shape = Load)) + 
  geom_point(size = 2, stat = 'identity') + geom_line() + 
  geom_errorbar(aes(ymin = m_cv - se_cv, ymax = m_cv + se_cv), width = 0.05) +
  scale_x_continuous(breaks=c(0.5, 0.8, 1.1, 1.4, 1.7)) +
  coord_cartesian(ylim = c(0.145, 0.34)) + 
  scale_y_continuous(breaks=c(0.16, 0.2, 0.24, 0.28, 0.32)) +
  labs(x="Durations (s)", y="CV", shape ="Memory Load", color = "Memory Load") +
  facet_grid(~ExpName2, labeller = labeller(ExpName2 = ExpName.labs))+
  theme_new + greySet3 + theme(legend.position = "none", 
                               strip.text.x = element_blank())

tmp3 <- mBias %>% filter(ExpName=='Encoding2' | ExpName=='Reproduction2'| ExpName=='baseline2')
tmp3$ExpName2 = factor(tmp3$ExpName, levels=c("Encoding2", "Reproduction2", "baseline2"))
fig_c6 = tmp3 %>% group_by(Load, ExpName2) %>% 
  summarise(bias = mean(ms_bias), se_bias = sd(ms_bias)/sqrt(n())) %>%
  ggplot(aes(ExpName2, bias, group=interaction(Load, ExpName2), fill = Load)) + 
  geom_bar(stat = 'identity', width = 0.75, position=position_dodge(.8)) + 
  geom_errorbar(aes(ymin = bias - se_bias, ymax = bias + se_bias, 
                    color = Load), width = 0.3, position=position_dodge(.8)) +
  scale_y_reverse() + coord_cartesian(ylim = c(-20, -180)) +
  scale_x_discrete(labels=c('Exp. 6a', 'Exp. 6b', 'Exp. 6c')) +
  labs(x="", y="Mean Bias (ms)", fill = "Memory Load", color = 'Memory Load') +
  theme_new + fillGreySet3 + greySet3 + theme(legend.position = "none", 
      plot.title = element_text(hjust = 0.5))

# combine figures
fig_exp6 = ggarrange(fig_a6, fig_b6, fig_cv6, fig_c6, labels=c('a','b','c','d'), 
                    ncol=2, nrow = 2, widths = c(4.7,2.3), heights= c(4,3.5),
                    common.legend = TRUE, legend = c("top"))
fig_exp6
# save figure
ggsave("./figures/fig_6_compact.png", fig_exp6, width = 7, height = 5)

```


```{r}
# analysis on Exp 6
# rmANOVA on mean Bias
av1 = mRep %>% filter(ExpName=='Encoding2' | ExpName=='Reproduction2'| ExpName=='baseline2') %>% 
  mutate(ExpName = as.factor(ExpName)) %>%
  ezANOVA(dv = m_bias, wid = NSub, within = .(DurLevel, Load, ExpName), 
          detailed = TRUE) %>%
  calParEta2()
print(av1)
print(GGcr(av1))

#rmANOVA on cti
av2 = mRep_cti %>% filter(ExpName=='Encoding2' | ExpName=='Reproduction2'| ExpName=='baseline2') %>% 
  ezANOVA(dv = cti, wid = NSub, within = Load, detailed = TRUE) %>%
  calParEta2()
print(av2)

#rmANOVA on general bias
av3 = mBias %>% filter(ExpName == 'Encoding2' | ExpName=='Reproduction2'| ExpName=='baseline2') %>% 
  ezANOVA(dv = ms_bias, wid = NSub, within = Load, detailed = TRUE) %>%
  calParEta2()
print(av3)
print(GGcr(av3))

# rmANOVA on cv 
av4 = mRep %>% filter(ExpName=='Encoding2' | ExpName=='Reproduction2'| ExpName=='baseline2') %>% 
  mutate(ExpName = as.factor(ExpName)) %>%
  ezANOVA(dv = cv, wid = NSub, within = .(DurLevel, Load, ExpName), detailed = TRUE) %>%
  calParEta2()
print(av4)
print(GGcr(av4))

```


```{r, message=FALSE, warning=FALSE}
# two-way ANOVA on Memory Load and sub-Experiment

# rmANOVA on cti
av2 = mRep_cti %>% filter(ExpName=='Encoding2' | ExpName=='Reproduction2'| ExpName=='baseline2') %>% 
  ezANOVA(dv = cti, wid = NSub, within = .(Load,ExpName), detailed = TRUE) %>%
  calParEta2()
print(av2)

# Post hoc pairwise t-test on cti by Memory load
mRep_cti %>% filter(ExpName=='Encoding2' | ExpName=='Reproduction2'| ExpName=='baseline2') %>% 
  group_by(NSub,Load) %>% summarise(m_cti = mean(cti), n = n()) -> mRep_cti_6load
pairwise.t.test(x = mRep_cti_6load$m_cti, g = mRep_cti_6load$Load, paired = TRUE, p.adjust.method = 'holm')

# cti values by Memory load
mRep_cti %>% filter(ExpName=='Encoding2' | ExpName=='Reproduction2'| ExpName=='baseline2') %>% 
  group_by(Load) %>% summarise(m_cti = mean(cti), se_cti = sd(cti)/sqrt(n()), n = n())

# Post hoc pairwise t-test on cti by Exps
mRep_cti %>% filter(ExpName=='Encoding2' | ExpName=='Reproduction2'| ExpName=='baseline2') %>% 
  group_by(NSub,ExpName) %>% summarise(m_cti = mean(cti), n = n()) -> mRep_cti_6exps
pairwise.t.test(x = mRep_cti_6exps$m_cti, g = mRep_cti_6exps$ExpName, paired = TRUE, p.adjust.method = 'holm')


# rmANOVA on general bias
av3 = mBias %>% filter(ExpName == 'Encoding2' | ExpName=='Reproduction2'| ExpName=='baseline2') %>% 
  ezANOVA(dv = ms_bias, wid = NSub, within = .(Load,ExpName), detailed = TRUE) %>%
  calParEta2()
print(av3)
print(GGcr(av3))

# Post hoc pairwise t-test on mean bias
mBias %>% filter(ExpName=='Encoding2' |ExpName=='Reproduction2'|ExpName=='baseline2') %>% 
  group_by(NSub,Load) %>% summarise(mBias = mean(ms_bias), n = n()) -> mRep_mBias_6
pairwise.t.test(x = mRep_mBias_6$mBias, g = mRep_gBias_6$Load, paired = TRUE, p.adjust.method = 'holm')

# mean bias values
mBias %>% filter(ExpName=='Encoding2' |ExpName=='Reproduction2'|ExpName=='baseline2') %>% 
  group_by(Load) %>% summarise(mBias = mean(ms_bias), seBias=sd(ms_bias)/sqrt(n()), n = n())


```

comparison of mean CTI between Exp. 6a and 6c

```{r exp6a_vs_6c, message=FALSE, warning=FALSE}
# rmANOVA on cti: 6a vs 6c
mRep_cti_6ac <- mRep_cti %>% filter(ExpName=='Encoding2' | ExpName=='baseline2')

av_6ac = mRep_cti_6ac %>% 
  ezANOVA(dv = cti, wid = NSub, within = .(Load,ExpName), detailed = TRUE) %>%
  calParEta2()
print(av_6ac)

# Post hoc pairwise t-test on cti by Loads
mRep_cti_6ac %>% group_by(NSub,Load) %>% 
  summarise(m_cti = mean(cti), n = n()) -> cti_6ac_load
pairwise.t.test(x = cti_6ac_load$m_cti, g = cti_6ac_load$Load, 
                paired = TRUE, p.adjust.method = 'holm')

# mean cti values by Memory load
mRep_cti_6ac %>% group_by(Load) %>% 
  summarise(m_cti = mean(cti), se_cti = sd(cti)/sqrt(n()), n = n())

# Post hoc pairwise t-test on cti by Exp
mRep_cti_6ac %>% group_by(NSub,ExpName) %>% 
  summarise(m_cti = mean(cti), n = n()) -> cti_6ac_exp
pairwise.t.test(x = cti_6ac_exp$m_cti, g = cti_6ac_exp$ExpName, 
                paired = TRUE, p.adjust.method = 'holm')

# mean cti values by Exp
mRep_cti_6ac %>% group_by(ExpName) %>% 
  summarise(m_cti = mean(cti), se_cti = sd(cti)/sqrt(n()), n = n())

# save CTI for each participant
mctiExp6acLongTab = 
  subset(mRep_cti_6ac, select=c(ExpName, NSub, Load, cti)) %>% 
  group_by(ExpName,NSub,Load) %>% 
  summarise(m_cti = mean(cti), n = n()) %>% 
  pivot_wider(names_from = c("ExpName","Load"), values_from = c(m_cti), names_sep="_")
#write.csv(mctiExp6acLongTab,paste0(getwd(),"/bhvrlt/mctiExp6acLongTab.csv"))

```

comparison of mean CTI between Exp. 6b and 6c

```{r exp6a_vs_6c, message=FALSE, warning=FALSE}
# rmANOVA on cti: 6b vs 6c
av_6bc = mRep_cti %>% filter(ExpName=='Reproduction2' | ExpName=='baseline2') %>% 
  ezANOVA(dv = cti, wid = NSub, within = .(Load,ExpName), detailed = TRUE) %>%
  calParEta2()
print(av_6bc)
print(GGcr(av_6bc))

```


comparison of general bias between Exp. 6a and 6c

```{r exp6b_vs_6c, message=FALSE, warning=FALSE}
# rmANOVA on general bias: 6a vs 6c
mBias_6ac <- mBias %>% filter(ExpName == 'Encoding2' | ExpName=='baseline2')
av_mB6ac = mBias_6ac %>% 
  ezANOVA(dv = ms_bias, wid = NSub, within = .(Load,ExpName), detailed = TRUE) %>%
  calParEta2()
print(av_mB6ac)
print(GGcr(av_mB6ac))

# Post hoc pairwise t-test on cti by Loads
mBias_6ac %>% group_by(NSub,Load) %>% summarise(m_bias = mean(ms_bias), n = n()) -> mB_6ac_load
pairwise.t.test(x = mB_6ac_load$m_bias, g = mB_6ac_load$Load, 
                paired = TRUE, p.adjust.method = 'holm')

mBias_6ac %>% group_by(Load) %>% 
  summarise(m_bias = mean(ms_bias), se_bias = sd(ms_bias)/sqrt(n()), n = n())

```


comparison of general bias between Exp. 6b and 6c

```{r exp6b_vs_6c, message=FALSE, warning=FALSE}
# rmANOVA on general bias: 6a vs 6c
mBias_6bc <- mBias %>% filter(ExpName == 'Reproduction2' | ExpName=='baseline2')
av_mB6bc = mBias_6bc %>% 
  ezANOVA(dv = ms_bias, wid = NSub, within = .(Load,ExpName), detailed = TRUE) %>%
  calParEta2()
print(av_mB6bc)
print(GGcr(av_mB6bc))

# Post hoc pairwise t-test on cti by Loads
mBias_6bc %>% group_by(NSub,Load) %>% summarise(m_bias = mean(ms_bias), n = n()) -> mB_6bc_load
pairwise.t.test(x = mB_6bc_load$m_bias, g = mB_6bc_load$Load, 
                paired = TRUE, p.adjust.method = 'holm')

mBias_6bc %>% group_by(Load) %>% 
  summarise(m_bias = mean(ms_bias), se_bias = sd(ms_bias)/sqrt(n()), n = n())

```

Post hoc pairwise t-test on general bias

```{r posthoc_exp6_cti, message=FALSE, warning=FALSE}
# pairwise t-test
mBias %>% filter(ExpName=='Encoding2' |ExpName=='Reproduction2'|ExpName=='baseline2') %>% 
  group_by(NSub,Load,ExpName) %>% summarise(mBias = mean(ms_bias), n = n()) -> mRep_gBias_6
pairwise.t.test(x = mRep_gBias_6$mBias, g = mRep_gBias_6$Load, paired = TRUE, p.adjust.method = 'holm')

# independent t-test on each condition
gBias_6 <- mRep_gBias_6 %>% pivot_wider(names_from = c("Load","ExpName"), 
                                        values_from = c(mBias), names_sep="_")
list <- colnames(gBias_6)
for (effect in list[3:11]) {
  rst <- t.test(gBias_6 %>% select(effect), mu = 0)
  print(paste(effect, '---------', rst$p.value))
}


```

Post hoc pairwise t-test on CV

```{r exp6_cv, message=FALSE, warning=FALSE}
# pairwise t-test
mRep %>% filter(ExpName=='Encoding2' |ExpName=='Reproduction2'|ExpName=='baseline2') %>% 
  group_by(NSub,ExpName) %>% summarise(mcv = mean(cv), n = n()) -> mRep_mcv_6
pairwise.t.test(x = mRep_mcv_6$mcv, g = mRep_mcv_6$ExpName, paired = TRUE, p.adjust.method = 'holm')

```


```{r}
# ANOVA on WM accuracy
mWM %>% filter(ExpName=='Encoding2'|ExpName=='Reproduction2'|ExpName=='baseline2') %>% 
  ezANOVA(dv = m_WMCrr, wid = NSub, within = .(Load, ExpName), detailed = TRUE) %>%
  calParEta2() -> avm2
print(avm2)

# post hoc pairwise t-test
mWM %>% filter(ExpName=='Encoding2'|ExpName=='Reproduction2'|ExpName=='baseline2') -> mWM6
pairwise.t.test(x = mWM6$m_WMCrr, g = mWM6$ExpName, paired = TRUE, p.adjust.method = 'holm')

# mean WM accuracy values
mWM %>% filter(ExpName=='Encoding2'|ExpName=='Reproduction2'|ExpName=='baseline2') %>% 
  group_by(Load) %>% summarise(mean(m_WMCrr), sd(m_WMCrr)/sqrt(n()))

mWM %>% filter(ExpName=='Encoding2'|ExpName=='Reproduction2'|ExpName=='baseline2') %>% 
  group_by(ExpName) %>% summarise(mean(m_WMCrr), sd(m_WMCrr)/sqrt(n()))

```



# 6a. working memory on encoding 2 (within-subject design)

```{r encoding2, message=FALSE, warning=FALSE}
# manipulation with encoding 2
fig_encoding2 = plot_fig('Encoding2', subfig = TRUE)
fig_encoding2$fig_a = fig_encoding2$fig_a +
  geom_text(aes(x = 0.8, y = 0.5, label = 'Exp. 6a'), size = 3, color = 'black')
fig_encoding2$fig_b = fig_encoding2$fig_b +
  geom_signif(y_position = c(0.55, 0.65), xmin = c(1,1), xmax = c(2, 3), 
              annotation = c("**", "**"))
fig_encoding2$fig_cv = fig_encoding2$fig_cv + 
  coord_cartesian(ylim = c(0.155, 0.34)) + 
  scale_y_continuous(breaks=c(0.16, 0.2, 0.24, 0.28, 0.32))

# combine figures
fig_6a = plot_grid(fig_encoding2$fig_a, fig_encoding2$fig_b, fig_encoding2$fig_cv, 
                   fig_encoding2$fig_c, labels = c('a', 'b', 'c','d'), nrow = 2)
fig_6a
# save figure
ggsave("./figures/fig_6a_encoding2.png", fig_6a, width = 7, height = 5)

```

Now rmANOVA on reproduction biases, CTI and general biases

```{r rmANOVA_encoding2, message=FALSE, warning=FALSE}
# rmANOVA on reproduction biases
av1 = mRep %>% filter(ExpName == 'Encoding2') %>% 
  ezANOVA(dv = m_bias, wid = NSub, within = .(DurLevel, Load), detailed = TRUE) %>%
  calParEta2()
print(av1)
print(GGcr(av1))

#rmANOVA on cti
av2 = mRep_cti %>% filter(ExpName == 'Encoding2') %>% 
  ezANOVA(dv = cti, wid = NSub, within = Load, detailed = TRUE) %>%
  calParEta2()
print(av2)

#rmANOVA on general bias
av3 = mBias %>% filter(ExpName == 'Encoding2') %>% 
  ezANOVA(dv = ms_bias, wid = NSub, within = Load, detailed = TRUE) %>%
  calParEta2()
print(av3)
print(GGcr(av3))

# rmANOVA on cv
av4 = mRep %>% filter(ExpName == 'Encoding2') %>% 
  ezANOVA(dv = cv, wid = NSub, within = .(DurLevel, Load), detailed = TRUE) %>%
  calParEta2()
print(av4)
print(GGcr(av4))

```

Post hoc pairwise t-test on general bias

```{r posthoc_encoding2, message=FALSE, warning=FALSE}
mBias %>% filter(ExpName == 'Encoding2')  -> mBias_rp
pairwise.t.test(x = mBias_rp$ms_bias, g = mBias_rp$Load, paired = TRUE, p.adjust.method = 'holm')
```

Post hoc pariwise t-test on cti

```{r posthoc_encoding2_cti, message=FALSE, warning=FALSE}
mRep_cti %>% filter(ExpName == 'Encoding2')  -> mRep_cti_rp
pairwise.t.test(x = mRep_cti_rp$cti, g = mRep_cti_rp$Load, paired = TRUE, p.adjust.method = 'holm')
```

```{r}
# ANOVA on WM accuracy
mWM %>% filter(ExpName == 'Encoding2') %>% 
  ezANOVA(dv = m_WMCrr, wid = NSub, within = Load, detailed = TRUE) %>%
  calParEta2() -> avm
print(avm)
print(GGcr(avm))

# mean accuracy values
mWM %>% filter(ExpName == 'Encoding2') %>% group_by(Load) %>% 
  summarise(mean(m_WMCrr), sd(m_WMCrr)/sqrt(n()))

```

# 6b. working memory on reproduction 2 (within-subject design)

```{r reproduction2, message=FALSE, warning=FALSE}
# reproduction manipulation
fig_reproduction2 = plot_fig('Reproduction2', subfig = TRUE)
fig_reproduction2$fig_a = fig_reproduction2$fig_a +
  geom_text(aes(x = 0.8, y = 0.5, label = 'Exp. 6b'), size = 3, color = 'black')
fig_reproduction2$fig_cv = fig_reproduction2$fig_cv + 
  coord_cartesian(ylim = c(0.16, 0.29)) + 
  scale_y_continuous(breaks=c(0.16, 0.2, 0.24, 0.28))

# combine figures
fig_6b = plot_grid(fig_reproduction2$fig_a, fig_reproduction2$fig_b, 
                   fig_reproduction2$fig_cv, fig_reproduction2$fig_c, 
                   labels = c('a', 'b', 'c','d'), nrow = 2)
fig_6b
# save figure
ggsave("./figures/fig_6b_reproduction2.png", fig_6b, width = 7, height = 5)

```

Now rmANOVA on reproduction biases, CTI and general biases

```{r rmANOVA_reproduction2, message=FALSE, warning=FALSE}
# rmANOVA on reproduction biases
av1 = mRep %>% filter(ExpName == 'Reproduction2') %>% 
  ezANOVA(dv = m_bias, wid = NSub, within = .(DurLevel, Load), detailed = TRUE) %>%
  calParEta2()
print(av1)
print(GGcr(av1))

#rmANOVA on cti
av2 = mRep_cti %>% filter(ExpName == 'Reproduction2') %>% 
  ezANOVA(dv = cti, wid = NSub, within = Load, detailed = TRUE) %>%
  calParEta2()
print(av2)
print(GGcr(av2))

#rmANOVA on general bias
av3 = mBias %>% filter(ExpName == 'Reproduction2') %>% 
  ezANOVA(dv = ms_bias, wid = NSub, within = Load, detailed = TRUE) %>%
  calParEta2()
print(av3)

#rmANOVA on cv
av4 = mRep %>% filter(ExpName == 'Reproduction2') %>% 
  ezANOVA(dv = cv, wid = NSub, within = .(DurLevel, Load), detailed = TRUE) %>%
  calParEta2()
print(av4)
print(GGcr(av4))

```

Results showed only the main effect of Duration. Memory loads were marginal...

```{r}
# ANOVA on WM accuracy
mWM %>% filter(ExpName == 'Reproduction2') %>% 
  ezANOVA(dv = m_WMCrr, wid = NSub, within = Load, detailed = TRUE) %>%
  calParEta2() -> avm
print(avm)
print(GGcr(avm))

# mean accuracy values
mWM %>% filter(ExpName == 'Reproduction2') %>% group_by(Load) %>% 
  summarise(mean(m_WMCrr), sd(m_WMCrr)/sqrt(n()))

```

# 6c. working memory on baseline 2 (within-subject design)

```{r baseline2, message=FALSE, warning=FALSE}
# baseline manipulation
fig_baseline2 = plot_fig('baseline2', subfig = TRUE)
fig_baseline2$fig_a = fig_baseline2$fig_a +
  geom_text(aes(x = 0.8, y = 0.5, label = 'Exp. 6c'), size = 3, color = 'black')

# combine figures
fig_6c = plot_grid(fig_baseline2$fig_a, fig_baseline2$fig_b, 
                   fig_baseline2$fig_cv, fig_baseline2$fig_c, 
                   labels = c('a', 'b', 'c','d'), nrow = 2)
fig_6c
# save figure
ggsave("./figures/fig_6c_baseline2.png", fig_6c, width = 7, height = 5)

```

Now rmANOVA on reproduction biases, CTI and general biases

```{r rmANOVA_baseline2, message=FALSE, warning=FALSE}
# rmANOVA on reproduction biases
av1 = mRep %>% filter(ExpName == 'baseline2') %>% 
  ezANOVA(dv = m_bias, wid = NSub, within = .(DurLevel, Load), detailed = TRUE) %>%
  calParEta2()
print(av1)
print(GGcr(av1))

#rmANOVA on cti
av2 = mRep_cti %>% filter(ExpName == 'baseline2') %>% 
  ezANOVA(dv = cti, wid = NSub, within = Load, detailed = TRUE) %>%
  calParEta2()
print(av2)

#rmANOVA on general bias
av3 = mBias %>% filter(ExpName == 'baseline2') %>% 
  ezANOVA(dv = ms_bias, wid = NSub, within = Load, detailed = TRUE) %>%
  calParEta2()
print(av3)

#rmANOVA on cv
av4 = mRep %>% filter(ExpName == 'baseline2') %>% 
  ezANOVA(dv = cv, wid = NSub, within = .(DurLevel, Load), detailed = TRUE) %>%
  calParEta2()
print(av4)
print(GGcr(av4))

```

Only the main effect of Duration was significant.

```{r}
# ANOVA on WM accuracy
mWM %>% filter(ExpName == 'baseline2') %>% 
  ezANOVA(dv = m_WMCrr, wid = NSub, within = Load, detailed = TRUE) %>%
  calParEta2() -> avm
print(avm)
print(GGcr(avm))

# mean accuracy values
mWM %>% filter(ExpName == 'baseline2') %>% group_by(Load) %>% 
  summarise(mean(m_WMCrr), sd(m_WMCrr)/sqrt(n()))

```


# [*3] cross-experiment analysis

## compare CTI for Exps 1 and 6a
```{r, message=FALSE, warning=FALSE}
# combined accuracy data from Exp1-4
mRep_cti %>% filter(ExpName=='Encoding' | ExpName=='Encoding2') %>% 
  group_by(ExpName, Load) -> ctiCrsEnc

ctiCrsEnc %>% mutate(ExpName = as.factor(ExpName)) %>%
  ezANOVA(dv = cti, wid = NSub, within = Load, between=ExpName, detailed = TRUE) %>%
  calParEta2() -> avCtiCrsEnc
print(avCtiCrsEnc)

# post hoc tests
pairwise.t.test(x = ctiCrsEnc$cti, g = ctiCrsEnc$ExpName, 
                paired = FALSE, p.adjust.method = 'holm')
pairwise.t.test(x = ctiCrsEnc$cti, g = ctiCrsEnc$Load, 
                paired = TRUE, p.adjust.method = 'holm')

# mean accuracy values for each exp.
ctiCrsEnc %>% filter(ExpName=='Encoding' | ExpName=='Encoding2') %>%
  group_by(ExpName) %>% summarise(mean(cti), sd(cti)/sqrt(n()))

```













