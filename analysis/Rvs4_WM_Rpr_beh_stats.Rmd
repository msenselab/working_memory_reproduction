---
title: "Analyses for Manuscript - Influences of working memory on Duration Reproduction"
author: "Jiao Wu"
date: "2024-05-23"
description: "adapted from Rvs3_WM_Rpr_beh_stats.Rmd and Rvs3_WM_Rpr_figs.Rmd"
output: html_document:
    df_print: paged
    number_sections: true
  pdf_document: 
    number_sections: true
    latex_engine: xelatex
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# load packages and functions {-}
```{r include=FALSE}
library(rlist)
library(ez)
library(tidyverse)
library(latex2exp)
library(lsr)
library(rticles)
library(DescTools)
library(heplots)
library(lme4)
library(rstatix)
library(boot)
library(ggpubr)
library(reshape2)
library(MASS)
library(lmerTest)
library(sjPlot)
library(dplyr)
```

```{r}
source('mytheme.R')
# model version
# modelversion = 'gap_log_rstan'
# rstanmodelPath = 'modelrlt'
# modelPath = paste0(rstanmodelPath, '/models/', modelversion)
```

# Description of the revision
For better understanding and linking findings across experiments, we have revise the order of experiments as follows:
Exp 1 <-- Exp 4: Renting working memory across encoding and reproduction
Exp 2 <-- Exp 5: Encoding-reproduction gap effect
Exp 3 <-- Exp 2: Encoding phase
Exp 4 <-- Exp 3: Reproduction phase
Exp 5 <-- Exp 1: No WM effect
Exp 6a,b,c <-- Exp 6a,b,c

Last, we apply a with-subject design and control the encoding-reproduction gap to confirm the WM effect on each phase (Exp 6a, 6b, 6c).

We use a linear fitting on the Reproduction as a function of Duration, and report the statistics of the estimated slope (CT) and intercept (PSS).


# preparation: Load all behavioural data and Calculate variables for analysis
```{r}
# load data
##################################
# load valid data for original Exp 1-5
AllExpData = read.csv(paste0("../data/AllValidData.csv")) %>% filter(valid == 1)
AllExpData$WMSize <- factor(AllExpData$WMSize, labels=c("low","medium","high"))
AllExpData$Exp = as.factor(AllExpData$Exp)
AllExpData$NSub = as.numeric(AllExpData$Exp)*100 + AllExpData$NSub
AllExpData$bias = AllExpData$repDur - AllExpData$curDur

Data_Exp1 <- AllExpData %>% filter(Exp == 'Exp4')
Data_Exp2 <- AllExpData %>% filter(Exp == 'Exp5')
Data_Exp3 <- AllExpData %>% filter(Exp == 'Exp2')
Data_Exp4 <- AllExpData %>% filter(Exp == 'Exp3')
Data_Exp5 <- AllExpData %>% filter(Exp == 'Exp1')

# load valid data for Exp 6a, 6b and 6c
Data_Exp6 <- read.csv(paste0("../data/Exp6.csv")) %>% filter(valid == 1)
Data_Exp6$WMSize <- factor(Data_Exp6$WMSize, labels = c("low","medium","high"))
Data_Exp6$Exp = as.factor(Data_Exp6$Exp)
Data_Exp6$bias = Data_Exp6$repDur - Data_Exp6$curDur
```

# 1. Working memory task Accuracy
```{r}
# calculate accuracy
##################################
Data_Exp1$WMCrr <- Data_Exp1$TPresent == Data_Exp1$WMRP
Data_Exp2$WMCrr <- Data_Exp2$TPresent == Data_Exp2$WMRP
Data_Exp3$WMCrr <- Data_Exp3$TPresent == Data_Exp3$WMRP
Data_Exp4$WMCrr <- Data_Exp4$TPresent == Data_Exp4$WMRP
Data_Exp5$WMCrr <- Data_Exp5$TPresent == Data_Exp5$WMRP
Data_Exp6$WMCrr <- Data_Exp6$TPresent == Data_Exp6$WMRP

# Exp 1 & 3-5 (factor: WM load)
WMCrr_Exp1 <- dplyr::group_by(Data_Exp1, WMSize, NSub) %>%
  dplyr::summarize(n = n(), m_WMCrr=mean(WMCrr), se_WMCrr=sd(WMCrr)/sqrt(n-1))
WMCrr_Exp1 %>% dplyr::group_by(WMSize) %>%
  dplyr::summarize(n = n(), mean_WMCrr = mean(m_WMCrr), 
                    se_WMCrr = sd(m_WMCrr)/sqrt(n-1) ) -> WMCrrForExp1

WMCrr_Exp3 <- dplyr::group_by(Data_Exp3, WMSize, NSub) %>%
  dplyr::summarize(n = n(), m_WMCrr=mean(WMCrr), se_WMCrr=sd(WMCrr)/sqrt(n-1))
WMCrr_Exp3 %>% dplyr::group_by(WMSize) %>%
  dplyr::summarize(n = n(), mean_WMCrr = mean(m_WMCrr), 
                    se_WMCrr = sd(m_WMCrr)/sqrt(n-1) ) -> WMCrrForExp3

WMCrr_Exp4 <- dplyr::group_by(Data_Exp4, WMSize, NSub) %>%
  dplyr::summarize(n = n(), m_WMCrr=mean(WMCrr), se_WMCrr=sd(WMCrr)/sqrt(n-1))
WMCrr_Exp4 %>% dplyr::group_by(WMSize) %>%
  dplyr::summarize(n = n(), mean_WMCrr = mean(m_WMCrr), 
                    se_WMCrr = sd(m_WMCrr)/sqrt(n-1) ) -> WMCrrForExp4

WMCrr_Exp5 <- dplyr::group_by(Data_Exp5, WMSize, NSub) %>%
  dplyr::summarize(n = n(), m_WMCrr=mean(WMCrr), se_WMCrr=sd(WMCrr)/sqrt(n-1))
WMCrr_Exp5 %>% dplyr::group_by(WMSize) %>%
  dplyr::summarize(n = n(), mean_WMCrr = mean(m_WMCrr), 
                    se_WMCrr = sd(m_WMCrr)/sqrt(n-1) ) -> WMCrrForExp5

# Exp 2 (factors: WM load, Gap)
WMCrr_Exp2 <- dplyr::group_by(Data_Exp2, WMSize, NSub, gap) %>%
  dplyr::summarize(n = n(), m_WMCrr = mean(WMCrr), se_WMCrr = sd(WMCrr)/sqrt(n-1))
WMCrr_Exp2$gap <- factor(WMCrr_Exp2$gap, labels = c("short", "long"))
WMCrr_Exp2 %>% dplyr::group_by(gap, WMSize) %>%
  dplyr::summarize(n = n(), mean_WMCrr = mean(m_WMCrr), 
                   se_WMCrr = sd(m_WMCrr)/sqrt(n-1)) -> WMCrrForExp2

# Exp 6 (factor: WM load, Exp)
WMCrr_Exp6 <- dplyr::group_by(Data_Exp6, Exp, WMSize, NSub) %>% 
  dplyr::summarize(n = n(), m_WMCrr = mean(WMCrr), 
                   se_WMCrr = sd(WMCrr)/sqrt(n-1))
WMCrr_Exp6 %>% dplyr::group_by(Exp, WMSize) %>%
  dplyr::summarize(n = n(), mean_WMCrr = mean(m_WMCrr),
                   se_WMCrr = sd(m_WMCrr)/sqrt(n-1) ) -> WMCrrForExp6

```

```{r}
# plot working memory task accuracy
##################################
# Exp 1

# # boxplot
#plt_box_WMCrr_Exp1 <- ggplot(WMCrr_Exp1,aes(x=WMSize, y=m_WMCrr, color = WMSize)) +
#  geom_boxplot() + 
#  geom_jitter(position=position_jitter(0.2)) +
#  geom_signif(comparisons=list(c("low", "medium")), annotations="", 
#              y_position = 0.95, tip_length = 0, vjust=0.4, color = 'black') +
#  annotate(geom="text", label="***", x=1.5, y=0.98, size=6) +
#  geom_signif(comparisons=list(c("medium", "high")), annotations="", 
#              y_position = 0.85, tip_length = 0, vjust=0.4, color = 'black') +
#  annotate(geom="text", label="***", x=2.5, y=0.88, size=6) +
#  coord_cartesian(ylim = c(0.5, 1)) +
#  labs(x = "Memory load", y = "Mean accuracy") + theme_new + colorSet3 +
#  theme(legend.position = "none")

# barplot
plt_bar_WMCrr_Exp1 <- ggplot(WMCrrForExp1,aes(x=WMSize, y=mean_WMCrr)) +
  geom_bar(stat="identity", fill="lightgrey", position=position_dodge()) +
  geom_errorbar(aes(ymin=mean_WMCrr-se_WMCrr, ymax=mean_WMCrr+se_WMCrr), 
                width=.1,  position = position_dodge()) +
  geom_signif(comparisons=list(c("low", "medium")), annotations="", 
              y_position = 0.93, tip_length = 0.05, vjust=0.4, color = 'black') +
  annotate(geom="text", label="***", x=1.5, y=0.96, size=6) +
  geom_signif(comparisons=list(c("medium", "high")), annotations="", 
              y_position = 0.83, tip_length = 0.05, vjust=0.4, color = 'black') +
  annotate(geom="text", label="***", x=2.5, y=0.86, size=6) +
  coord_cartesian(ylim = c(0.5, 1)) +
  labs(x="Memory load", y="Mean accuracy", title="Memory test") +
  theme_new +
  theme(plot.title = element_text(hjust = 0.5))
plt_bar_WMCrr_Exp1

# Exp 2
plt_bar_WMCrr_Exp2 <- ggplot(WMCrrForExp2,aes(x=gap, y=mean_WMCrr, 
                                              group=interaction(WMSize, gap))) +
  geom_bar(stat="identity", aes(fill=WMSize), position=position_dodge()) +
  geom_errorbar(aes(ymin=mean_WMCrr-se_WMCrr, ymax=mean_WMCrr+se_WMCrr), 
                width=.1, position = position_dodge(.9)) + 
  coord_cartesian(ylim = c(0.5, 1)) +
  geom_signif(annotations=c("***","***","***","***"), 
              y_position = c(0.96, 0.86, 0.96, 0.86), tip_length = 0.05, 
              xmin = c(0.6, 1, 1.6, 2), xmax = c(1, 1.4, 2, 2.4),
              color = 'black') +
  labs(x="Gap", y="Mean accuracy", fill="Memory Load", title="Memory test") +
  theme_new + fillGreySet3 + theme(plot.title = element_text(hjust = 0.5))
plt_bar_WMCrr_Exp2

# plt_bar_WMCrr_Exp2 <- ggplot(WMCrrForExp2,aes(x=WMSize, y=mean_WMCrr, 
#                                               group=interaction(WMSize, gap))) +
#   geom_bar(stat="identity", aes(fill=gap), position=position_dodge()) +
#   geom_errorbar(aes(ymin=mean_WMCrr-se_WMCrr, ymax=mean_WMCrr+se_WMCrr), 
#                 width=.1, position = position_dodge(.9)) + 
#   coord_cartesian(ylim = c(0.5, 1)) +
#   geom_signif(annotations=c("***","***","***","***"), 
#               y_position = c(0.98, 0.93, 0.86, 0.81), tip_length = 0.05, 
#               xmin = c(0.8, 1.2, 1.8, 2.2), xmax = c(1.8, 2.2, 2.8, 3.2),
#               color = 'black') +
#   labs(x="Memory load", y="Mean accuracy", title="Memory test") +
#   scale_fill_manual(values=c('lightgray','#999999')) + theme_new +
#   theme(plot.title = element_text(hjust = 0.5))
# plt_bar_WMCrr_Exp2

# Exp 3
plt_bar_WMCrr_Exp3 <- ggplot(WMCrrForExp3,aes(x=WMSize, y=mean_WMCrr)) +
  geom_bar(stat="identity", fill="lightgrey", position=position_dodge()) +
  geom_errorbar(aes(ymin=mean_WMCrr-se_WMCrr, ymax=mean_WMCrr+se_WMCrr), 
                width=.1,  position = position_dodge()) +
  geom_signif(comparisons=list(c("low", "medium")), annotations="", 
              y_position = 0.96, tip_length = 0.05, vjust=0.4, color = 'black') +
  annotate(geom="text", label="***", x=1.5, y=0.99, size=6) +
  geom_signif(comparisons=list(c("medium", "high")), annotations="", 
              y_position = 0.83, tip_length = 0.05, vjust=0.4, color = 'black') +
  annotate(geom="text", label="**", x=2.5, y=0.86, size=6) +
  coord_cartesian(ylim = c(0.5, 1)) +
  labs(x="Memory load", y="Mean accuracy", title="Memory test") +
  theme_new +
  theme(plot.title = element_text(hjust = 0.5))
plt_bar_WMCrr_Exp3

# Exp 4
plt_bar_WMCrr_Exp4 <- ggplot(WMCrrForExp4,aes(x=WMSize, y=mean_WMCrr)) +
  geom_bar(stat="identity", fill="lightgrey", position=position_dodge()) +
  geom_errorbar(aes(ymin=mean_WMCrr-se_WMCrr, ymax=mean_WMCrr+se_WMCrr), 
                width=.1,  position = position_dodge()) +
  geom_signif(comparisons=list(c("low", "medium")), annotations="", 
              y_position = 0.96, tip_length = 0.05, vjust=0.4, color = 'black') +
  annotate(geom="text", label="***", x=1.5, y=0.99, size=6) +
  geom_signif(comparisons=list(c("medium", "high")), annotations="", 
              y_position = 0.83, tip_length = 0.05, vjust=0.4, color = 'black') +
  annotate(geom="text", label="***", x=2.5, y=0.86, size=6) +
  coord_cartesian(ylim = c(0.5, 1)) +
  labs(x="Memory load", y="Mean accuracy", title="Memory test") +
  theme_new +
  theme(plot.title = element_text(hjust = 0.5))
plt_bar_WMCrr_Exp4

# Exp 5
plt_bar_WMCrr_Exp5 <- ggplot(WMCrrForExp5,aes(x=WMSize, y=mean_WMCrr)) +
  geom_bar(stat="identity", fill="lightgrey", position=position_dodge()) +
  geom_errorbar(aes(ymin=mean_WMCrr-se_WMCrr, ymax=mean_WMCrr+se_WMCrr), 
                width=.1,  position = position_dodge()) +
  geom_signif(comparisons=list(c("low", "medium")), annotations="", 
              y_position = 0.98, tip_length = 0.05, vjust=0.4, color = 'black') +
  annotate(geom="text", label="***", x=1.5, y=1.01, size=6) +
  geom_signif(comparisons=list(c("medium", "high")), annotations="", 
              y_position = 0.86, tip_length = 0.05, vjust=0.4, color = 'black') +
  annotate(geom="text", label="***", x=2.5, y=0.89, size=6) +
  coord_cartesian(ylim = c(0.5, 1)) +
  labs(x="Memory load", y="Mean accuracy", title="Memory test") +
  theme_new +
  theme(plot.title = element_text(hjust = 0.5))
plt_bar_WMCrr_Exp5

# Exp 6
plt_bar_WMCrr_Exp6 <- ggplot(WMCrrForExp6,aes(x=Exp, y=mean_WMCrr, 
                                              group=interaction(WMSize, Exp))) +
  geom_bar(stat="identity", aes(fill=WMSize), position=position_dodge()) +
  geom_errorbar(aes(ymin=mean_WMCrr-se_WMCrr, ymax=mean_WMCrr+se_WMCrr), 
                width=.1, position = position_dodge(.9)) + 
  coord_cartesian(ylim = c(0.5, 1)) +
  geom_signif(annotations=c("***","***","***","***","***","***"), 
              y_position = c(0.96, 0.86, 0.95, 0.84, 0.98, 0.89), tip_length = 0.05, 
              xmin = c(0.7, 1, 1.7, 2, 2.7, 3), xmax = c(1, 1.3, 2, 2.3, 3, 3.3),
              color = 'black') +
  labs(x="Experiment", y="Mean accuracy", fill="Memory Load", title="Memory test") + 
  theme_new + fillGreySet3 + theme(plot.title = element_text(hjust = 0.5))
plt_bar_WMCrr_Exp6

# plt_bar_WMCrr_Exp6 <- ggplot(WMCrrForExp6,aes(x=WMSize, y=mean_WMCrr, 
#                                               group=interaction(WMSize, Exp))) +
#   geom_bar(stat="identity", aes(fill=Exp), position=position_dodge()) +
#   geom_errorbar(aes(ymin=mean_WMCrr-se_WMCrr, ymax=mean_WMCrr+se_WMCrr), 
#                 width=.1, position = position_dodge(.9)) + 
#   geom_signif(comparisons=list(c("low", "medium")), annotations="", 
#               y_position = 0.96, tip_length = 0.05, vjust=0.4, color = 'black') +
#   annotate(geom="text", label="***", x=1.5, y=0.99, size=6) +
#   geom_signif(comparisons=list(c("medium", "high")), annotations="", 
#               y_position = 0.86, tip_length = 0.05, vjust=0.4, color = 'black') +
#   annotate(geom="text", label="***", x=2.5, y=0.89, size=6) +
#   coord_cartesian(ylim = c(0.5, 1)) +
#   labs(x="Memory load", y="Mean accuracy", title="Memory test") +
#   scale_fill_manual(values=c('lightgray','#999999','grey30')) + theme_new +
#   theme(plot.title = element_text(hjust = 0.5))
# plt_bar_WMCrr_Exp6

# plt_WMCrr_Exp6 <- ggplot(WMCrrForExp6, aes(WMSize, mean_WMCrr,
#      ymin = mean_WMCrr - se_WMCrr, ymax = mean_WMCrr + se_WMCrr, group=Exp)) +
#   geom_line(aes(linetype = Exp),
#             stat = "identity", position = position_dodge(width = 0.2))+
#   geom_point(size = 1.5, stat="identity", position=position_dodge(width=0.2)) +
#   geom_errorbar(width = .15,  position = position_dodge(width = 0.2)) +
#   coord_cartesian(ylim = c(0.5, 1)) +
#   labs(x = "Memory load", y = "Mean accuracy") +
#   theme_new + theme(legend.position = "top",
#                     legend.justification = c(.8, .8),
#                     legend.text = element_text(size = 8),
#                     legend.title = element_text(size = 8, face = "bold"))
# plt_WMCrr_Exp6

```

# 2. Duration reproduction bias
```{r}
# calculate reproduction bias
##################################

# Exp 1 & 3-5 (factors: Duration, WM load)
mRpr_Exp1_sub <- dplyr::group_by(Data_Exp1, curDur, NSub, WMSize) %>%
  dplyr::summarize(n = n(), m_repDur = mean(repDur), sd_repDur = sd(repDur),
                   cv = sd_repDur/ m_repDur, mBias = mean(repDur-curDur),
                   sdBias = sd(repDur-curDur))
mRpr_Exp1 <- mRpr_Exp1_sub %>% dplyr::group_by(curDur, WMSize) %>% 
  dplyr::summarize(n = n(), m_m_repDur = mean(m_repDur),
                   m_bias = mean(m_repDur-curDur), 
                   se_bias = sd(m_repDur-curDur)/sqrt(n-1),
                   m_cv= mean(cv), se_cv=sd(cv)/sqrt(n-1))

mRpr_Exp3_sub <- dplyr::group_by(Data_Exp3, curDur, NSub, WMSize) %>%
  dplyr::summarize(n = n(), m_repDur = mean(repDur), sd_repDur = sd(repDur),
                   cv = sd_repDur/ m_repDur, mBias = mean(repDur-curDur),
                   sdBias = sd(repDur-curDur))
mRpr_Exp3 <- mRpr_Exp3_sub %>% dplyr::group_by(curDur, WMSize) %>% 
  dplyr::summarize(n = n(), m_m_repDur = mean(m_repDur),
                   m_bias = mean(m_repDur-curDur), 
                   se_bias = sd(m_repDur-curDur)/sqrt(n-1),
                   m_cv= mean(cv), se_cv=sd(cv)/sqrt(n-1))

mRpr_Exp4_sub <- dplyr::group_by(Data_Exp4, curDur, NSub, WMSize) %>%
  dplyr::summarize(n = n(), m_repDur = mean(repDur), sd_repDur = sd(repDur),
                   cv = sd_repDur/ m_repDur, mBias = mean(repDur-curDur),
                   sdBias = sd(repDur-curDur))
mRpr_Exp4 <- mRpr_Exp4_sub %>% dplyr::group_by(curDur, WMSize) %>% 
  dplyr::summarize(n = n(), m_m_repDur = mean(m_repDur),
                   m_bias = mean(m_repDur-curDur), 
                   se_bias = sd(m_repDur-curDur)/sqrt(n-1),
                   m_cv= mean(cv), se_cv=sd(cv)/sqrt(n-1))

mRpr_Exp5_sub <- dplyr::group_by(Data_Exp5, curDur, NSub, WMSize) %>%
  dplyr::summarize(n = n(), m_repDur = mean(repDur), sd_repDur = sd(repDur),
                   cv = sd_repDur/ m_repDur, mBias = mean(repDur-curDur),
                   sdBias = sd(repDur-curDur))
mRpr_Exp5 <- mRpr_Exp5_sub %>% dplyr::group_by(curDur, WMSize) %>% 
  dplyr::summarize(n = n(), m_m_repDur = mean(m_repDur),
                   m_bias = mean(m_repDur-curDur), 
                   se_bias = sd(m_repDur-curDur)/sqrt(n-1),
                   m_cv= mean(cv), se_cv=sd(cv)/sqrt(n-1))

# Exp 2 (factors: Duration, WM load, gap)
Data_Exp2$gap <- factor(Data_Exp2$gap, labels = c("short", "long")) # mark Gap

mRpr_Exp2_sub <- dplyr::group_by(Data_Exp2, curDur, NSub, WMSize, gap) %>%
  dplyr::summarize(n = n(), m_repDur = mean(repDur), sd_repDur = sd(repDur),
                   cv = sd_repDur/ m_repDur)
mRpr_Exp2 <- mRpr_Exp2_sub %>% dplyr::group_by(curDur, WMSize, gap) %>% 
  dplyr::summarize(n = n(), m_m_repDur = mean(m_repDur),
                   m_bias = mean(m_repDur-curDur), 
                   se_bias = sd(m_repDur-curDur)/sqrt(n-1),
                   m_cv= mean(cv), se_cv=sd(cv)/sqrt(n-1))
mRpr_Exp2$Gap = factor(mRpr_Exp2$gap, labels=c("short gap","long gap"))

# Exp 6 (factors: Duration, WM load, Exp)
mRpr_Exp6_sub <-  dplyr::group_by(Data_Exp6, curDur, Exp, NSub, WMSize) %>%
  dplyr::summarize(n = n(), m_repDur = mean(repDur), sd_repDur = sd(repDur),
                   cv = sd_repDur/ m_repDur)
mRpr_Exp6 <- mRpr_Exp6_sub %>% dplyr::group_by(Exp, curDur, WMSize) %>% 
  dplyr::summarize(n = n(), m_m_repDur = mean(m_repDur),
                   m_bias = mean(m_repDur-curDur),
                   se_bias = sd(m_repDur-curDur)/sqrt(n-1),
                   m_cv= mean(cv), se_cv=sd(cv)/sqrt(n-1))

```

```{r}
# plot reproduction bias
##################################
jt <- 0.03
# Exp 1
plt_RprBias_Exp1 <- ggplot(data = mRpr_Exp1,
                           aes(curDur, m_bias, ymin = m_bias - se_bias, 
                               ymax = m_bias + se_bias, group = WMSize,
                               color=as.factor(WMSize), 
                               shape = as.factor(WMSize))) +
  geom_line(aes(color = WMSize), 
            stat = "identity",position = position_dodge(width = jt)) + 
  geom_hline(yintercept = 0, linetype='dashed') +
  geom_point(size = 2, stat="identity", position=position_dodge(width=jt)) +
  geom_errorbar(width=.2,  position = position_dodge(width = jt)) +
  coord_cartesian(ylim = c(-0.5, 0.4)) +
  scale_x_continuous(breaks=c(0.5, 0.8, 1.1, 1.4, 1.7)) +
  labs(x="Durations (s)", y="Reproduction bias (s)", title="Duration Reproduction",
       shape ="Memory Load", color = "Memory Load") +
  theme_new + greySet3 +
  theme(legend.position = c(.7,.8), 
        legend.text = element_text(size = 10), 
        legend.title = element_text(size = 10, face = "bold"),
        plot.title = element_text(hjust = 0.5))


# Exp 2
plt_RprBias_Exp2 <- ggplot(data = mRpr_Exp2,
                           aes(curDur, m_bias, ymin = m_bias - se_bias, 
                               ymax = m_bias + se_bias, 
                               group = interaction(WMSize, Gap),
                               color=as.factor(WMSize), 
                               shape=as.factor(WMSize))) +
  geom_line(stat = "identity",position = position_dodge(width = jt)) +
  geom_hline(yintercept = 0, linetype='dashed') +
  geom_point(size = 2, stat="identity", position=position_dodge(width=jt)) +
  geom_errorbar(width=.2,  position = position_dodge(width = jt)) +
  facet_wrap("Gap") +
  coord_cartesian(ylim = c(-0.5, 0.4)) +
  scale_x_continuous(breaks=c(0.5, 0.8, 1.1, 1.4, 1.7)) +
  labs(x="Durations (s)", y="Reproduction bias (s)", title="Duration Reproduction",
       shape ="Memory Load", color = "Memory Load") +
  theme_new + greySet3 + 
  theme(legend.position = c(.8,.8), 
        legend.text = element_text(size = 10), 
        legend.title = element_text(size = 10, face = "bold"),
        plot.title = element_text(hjust = 0.5))

 
# Exp 3
plt_RprBias_Exp3 <- ggplot(data = mRpr_Exp3,
                           aes(curDur, m_bias, ymin = m_bias - se_bias, 
                               ymax = m_bias + se_bias, group = WMSize,
                               color=as.factor(WMSize), 
                               shape = as.factor(WMSize))) +
  geom_line(aes(color = WMSize), 
            stat = "identity",position = position_dodge(width = jt)) +
  geom_hline(yintercept = 0, linetype='dashed') +
  geom_point(size = 2, stat="identity", position=position_dodge(width=jt)) +
  geom_errorbar(width=.2,  position = position_dodge(width = jt)) +
  coord_cartesian(ylim = c(-0.5, 0.4)) +
  scale_x_continuous(breaks=c(0.5, 0.8, 1.1, 1.4, 1.7)) +
  labs(x="Durations (s)", y="Reproduction bias (s)", title="Duration Reproduction",
       shape ="Memory Load", color = "Memory Load")+
  theme_new + greySet3 +
  theme(legend.position = c(.7,.8), 
        legend.text = element_text(size = 10), 
        legend.title = element_text(size = 10, face = "bold"),
        plot.title = element_text(hjust = 0.5))


# Exp 4
plt_RprBias_Exp4 <- ggplot(data = mRpr_Exp4,
                           aes(curDur, m_bias, ymin = m_bias - se_bias, 
                               ymax = m_bias + se_bias, group = WMSize,
                               color=as.factor(WMSize), 
                               shape = as.factor(WMSize))) +
  geom_line(aes(color = WMSize), 
            stat = "identity", position = position_dodge(width = jt)) +
  geom_hline(yintercept = 0, linetype='dashed') +
  geom_point(size = 2, stat="identity", position=position_dodge(width=jt)) +
  geom_errorbar(width=.2,  position = position_dodge(width = jt)) +
  coord_cartesian(ylim = c(-0.5, 0.4)) +
  scale_x_continuous(breaks=c(0.5, 0.8, 1.1, 1.4, 1.7)) +
  labs(x="Durations (s)", y="Reproduction bias (s)", title="Duration Reproduction",
       shape ="Memory Load", color = "Memory Load")+
  theme_new + greySet3 +
  theme(legend.position = c(.7,.8), 
        legend.text = element_text(size = 10), 
        legend.title = element_text(size = 10, face = "bold"),
        plot.title = element_text(hjust = 0.5))


# Exp 5
plt_RprBias_Exp5 <- ggplot(data = mRpr_Exp5,
                           aes(curDur, m_bias, ymin = m_bias - se_bias, 
                               ymax = m_bias + se_bias, group = WMSize,
                               color=as.factor(WMSize), 
                               shape = as.factor(WMSize))) +
  geom_line(aes(color = WMSize), 
            stat = "identity",position = position_dodge(width = jt)) +
  geom_hline(yintercept = 0, linetype='dashed') +
  geom_point(size = 2, stat="identity", position=position_dodge(width=jt)) +
  geom_errorbar(width=.2,  position = position_dodge(width = jt)) +
  coord_cartesian(ylim = c(-0.5, 0.4)) +
  scale_x_continuous(breaks=c(0.5, 0.8, 1.1, 1.4, 1.7)) +
  labs(x="Durations (s)", y="Reproduction bias (s)", title="Duration Reproduction",
       shape ="Memory Load", color = "Memory Load")+
  theme_new + greySet3 +
  theme(legend.position = c(.7,.8), 
        legend.text = element_text(size = 10), 
        legend.title = element_text(size = 10, face = "bold"),
        plot.title = element_text(hjust = 0.5))

# Exp 6
plt_RprBias_Exp6 <- ggplot(data = mRpr_Exp6,
                           aes(curDur, m_bias, ymin = m_bias - se_bias, 
                               ymax = m_bias + se_bias,
                               group = interaction(WMSize, Exp),
                               color = as.factor(WMSize), 
                               shape = as.factor(WMSize))) +
  geom_line(aes(color = WMSize),
            stat = "identity", position = position_dodge(width = jt)) +
  geom_hline(yintercept = 0, linetype='dashed') +
  geom_point(size = 2, stat="identity", position=position_dodge(width=jt)) +
  geom_errorbar(width=.2,  position = position_dodge(width = jt)) +
  facet_wrap("Exp") +
  coord_cartesian(ylim = c(-0.35, 0.2)) +
  scale_x_continuous(breaks=c(0.5, 0.8, 1.1, 1.4, 1.7)) +
  labs(x="", y="Reproduction bias (s)", title="Duration Reproduction",
       shape ="Memory Load", color = "Memory Load") + 
  theme_new + greySet3 + 
  theme(legend.position = c(.9,.8), 
        legend.text = element_text(size = 10), 
        legend.title = element_text(size = 10, face = "bold"),
        strip.text = element_text(size=10, face = "bold"),
        plot.title = element_text(hjust = 0.5))


plt_RprBias_Exp1
plt_RprBias_Exp2
plt_RprBias_Exp3
plt_RprBias_Exp4
plt_RprBias_Exp5
plt_RprBias_Exp6

```
# Linear mixed-effect model for reproduction bias

```{r}
# linear mixed-effect model with dependent variable bias, fixed effect duration, WMSize, and their interaction, random effect NSub
m_Exp1 = Data_Exp1 %>% group_by(NSub, curDur, WMSize) %>% summarise(mbias = mean(bias)*1000)
# map WMSize to numeric
m_Exp1$WMSize = as.numeric(m_Exp1$WMSize)
model_1 = lmer(mbias ~ curDur * WMSize + (1|NSub), data = m_Exp1)
# summary of the model
summary(model_1)
```


```{r}
# linear mixed-effect model with dependent variable bias, fixed effect duration, WMSize, and their interaction, random effect NSub
m_Exp2 = Data_Exp2 %>% group_by(NSub, curDur, WMSize) %>% summarise(mbias = mean(bias)*1000)
# map WMSize to numeric 
m_Exp2$WMSize = as.numeric(m_Exp2$WMSize)
model_2 = lmer(mbias ~ curDur * WMSize + (1|NSub), data = m_Exp2)
# summary of the model
summary(model_2)
```


```{r}
# linear mixed-effect model with dependent variable bias, fixed effect duration, WMSize, and their interaction, random effect NSub
m_Exp3 = Data_Exp3 %>% group_by(NSub, curDur, WMSize) %>% summarise(mbias = mean(bias)*1000)
# map WMSize to numeric 
m_Exp3$WMSize = as.numeric(m_Exp3$WMSize)
model_3 = lmer(mbias ~ curDur * WMSize + (1|NSub), data = m_Exp3)
# summary of the model
summary(model_3)
```

```{r}
# linear mixed-effect model with dependent variable bias, fixed effect duration, WMSize, and their interaction, random effect NSub
m_Exp4 = Data_Exp4 %>% group_by(NSub, curDur, WMSize) %>% summarise(mbias = mean(bias)*1000)
# map WMSize to numeric 
m_Exp4$WMSize = as.numeric(m_Exp4$WMSize)
model_4 = lmer(mbias ~ curDur * WMSize + (1|NSub), data = m_Exp4)
# summary of the model
summary(model_4)
```
# 3. linear fitting for reproduction bias

```{r}
# linear fitting and estimate slope and indifference point (IP)
##################################

### linear fitting
# Exp1
tmp_lm_wm = Data_Exp1 %>% group_by(WMSize,NSub) %>% do(model = lm(bias ~ curDur, data = .))
tmp_coef <- tibble()
for (x in 1:48) {
  tmp_coef <- bind_rows(tmp_coef, coef(tmp_lm_wm$model[[x]]))
}
tmp_coef$ind_pnt = -tmp_coef$`(Intercept)`/tmp_coef$curDur

tmp_SlpIP_sub <- tibble("NSub"=tmp_lm_wm$NSub, "WMSize"=tmp_lm_wm$WMSize, 
  "slope"=tmp_coef$curDur, "intercept"=tmp_coef$`(Intercept)`, "ind_pnt"=tmp_coef$ind_pnt)
tmp_SlpIP <- tmp_SlpIP_sub %>% dplyr::group_by(WMSize) %>%
  dplyr::summarize(n = n(), m_slope = mean(slope), se_slope=sd(slope)/sqrt(n-1),
                   m_intspt = mean(intercept), m_ip = mean(ind_pnt), se_ip=sd(ind_pnt)/sqrt(n-1))
# predict reproduction bias
tmp_pred_bias <- tibble(curDur = mRpr_Exp1$curDur, WMSize = mRpr_Exp1$WMSize)
tmp_pred_bias <- left_join(tmp_pred_bias, tmp_SlpIP, by = "WMSize")
tmp_pred_bias$pred_intcpt = -tmp_pred_bias$m_slope * tmp_pred_bias$m_ip
tmp_pred_bias$pred_y = tmp_pred_bias$curDur * tmp_pred_bias$m_slope + tmp_pred_bias$pred_intcpt
tb_SlpIP_Exp1 <- tmp_SlpIP
tb_SlpIP_Exp1_sub <- tmp_SlpIP_sub
tb_pred_bias_Exp1 <- tmp_pred_bias
plt_ip_Exp1 <- data.frame(ip_x = tmp_SlpIP$m_ip, ip_y = c(-0.15, -0.25, -0.3))

# Exp2
tmp_lm_wm = Data_Exp2 %>% group_by(gap,WMSize,NSub) %>% do(model = lm(bias ~ curDur, data = .))
tmp_coef <- tibble()
for (x in 1:96) {
  tmp_coef <- bind_rows(tmp_coef, coef(tmp_lm_wm$model[[x]]))
}
tmp_coef$ind_pnt = -tmp_coef$`(Intercept)`/tmp_coef$curDur

tmp_SlpIP_sub <- tibble("NSub"=tmp_lm_wm$NSub, "gap"=tmp_lm_wm$gap, "WMSize"=tmp_lm_wm$WMSize, 
  "slope"=tmp_coef$curDur, "intercept"=tmp_coef$`(Intercept)`, "ind_pnt"=tmp_coef$ind_pnt)
tmp_SlpIP <- tmp_SlpIP_sub %>% dplyr::group_by(gap,WMSize) %>%
  dplyr::summarize(n = n(), m_slope = mean(slope), se_slope=sd(slope)/sqrt(n-1),
                   m_intspt = mean(intercept), m_ip = mean(ind_pnt), se_ip=sd(ind_pnt)/sqrt(n-1))
# predict reproduction bias
tmp_pred_bias <- tibble(curDur = mRpr_Exp2$curDur, gap = mRpr_Exp2$gap, WMSize = mRpr_Exp2$WMSize)
tmp_pred_bias <- left_join(tmp_pred_bias, tmp_SlpIP, by = c("gap", "WMSize"))
tmp_pred_bias$pred_intcpt = -tmp_pred_bias$m_slope * tmp_pred_bias$m_ip
tmp_pred_bias$pred_y = tmp_pred_bias$curDur * tmp_pred_bias$m_slope + tmp_pred_bias$pred_intcpt
tb_SlpIP_Exp2 <- tmp_SlpIP
tb_SlpIP_Exp2_sub <- tmp_SlpIP_sub
tb_pred_bias_Exp2 <- tmp_pred_bias
plt_ip_Exp2 <- data.frame(gap = tmp_SlpIP$gap, wm = tmp_SlpIP$WMSize,
                         ip_x = tmp_SlpIP$m_ip, 
                         ip_y = c(-0.15, -0.25, -0.3, -0.18, -0.28, -0.33))

# Exp3
# estimate slope and IP
tmp_lm_wm = Data_Exp3 %>% group_by(WMSize,NSub) %>% do(model = lm(bias ~ curDur, data = .))
tmp_coef <- tibble()
for (x in 1:48) {
  tmp_coef <- bind_rows(tmp_coef, coef(tmp_lm_wm$model[[x]]))
}
tmp_coef$ind_pnt = -tmp_coef$`(Intercept)`/tmp_coef$curDur

tmp_SlpIP_sub <- tibble("NSub"=tmp_lm_wm$NSub, "WMSize"=tmp_lm_wm$WMSize, 
  "slope"=tmp_coef$curDur, "intercept"=tmp_coef$`(Intercept)`, "ind_pnt"=tmp_coef$ind_pnt)
tmp_SlpIP <- tmp_SlpIP_sub %>% dplyr::group_by(WMSize) %>%
  dplyr::summarize(n = n(), m_slope = mean(slope), se_slope=sd(slope)/sqrt(n-1),
                   m_intspt = mean(intercept), m_ip = mean(ind_pnt), se_ip=sd(ind_pnt)/sqrt(n-1))
# predict reproduction bias
tmp_pred_bias <- tibble(curDur = mRpr_Exp3$curDur, WMSize = mRpr_Exp3$WMSize)
tmp_pred_bias <- left_join(tmp_pred_bias, tmp_SlpIP, by = "WMSize")
tmp_pred_bias$pred_intcpt = -tmp_pred_bias$m_slope * tmp_pred_bias$m_ip
tmp_pred_bias$pred_y = tmp_pred_bias$curDur * tmp_pred_bias$m_slope + tmp_pred_bias$pred_intcpt
tb_SlpIP_Exp3 <- tmp_SlpIP
tb_SlpIP_Exp3_sub <- tmp_SlpIP_sub
tb_pred_bias_Exp3 <- tmp_pred_bias
plt_ip_Exp3 <- data.frame(ip_x = tmp_SlpIP$m_ip, ip_y = c(-0.15, -0.25, -0.3))


# Exp4
tmp_lm_wm = Data_Exp4 %>% group_by(WMSize,NSub) %>% do(model = lm(bias ~ curDur, data = .))
tmp_coef <- tibble()
for (x in 1:48) {
  tmp_coef <- bind_rows(tmp_coef, coef(tmp_lm_wm$model[[x]]))
}
tmp_coef$ind_pnt = -tmp_coef$`(Intercept)`/tmp_coef$curDur

tmp_SlpIP_sub <- tibble("NSub"=tmp_lm_wm$NSub, "WMSize"=tmp_lm_wm$WMSize, 
  "slope"=tmp_coef$curDur, "intercept"=tmp_coef$`(Intercept)`, "ind_pnt"=tmp_coef$ind_pnt)
tmp_SlpIP <- tmp_SlpIP_sub %>% dplyr::group_by(WMSize) %>%
  dplyr::summarize(n = n(), m_slope = mean(slope), se_slope=sd(slope)/sqrt(n-1),
                   m_intspt = mean(intercept), m_ip = mean(ind_pnt), se_ip=sd(ind_pnt)/sqrt(n-1))
# predict reproduction bias
tmp_pred_bias <- tibble(curDur = mRpr_Exp4$curDur, WMSize = mRpr_Exp4$WMSize)
tmp_pred_bias <- left_join(tmp_pred_bias, tmp_SlpIP, by = "WMSize")
tmp_pred_bias$pred_intcpt = -tmp_pred_bias$m_slope * tmp_pred_bias$m_ip
tmp_pred_bias$pred_y = tmp_pred_bias$curDur * tmp_pred_bias$m_slope + tmp_pred_bias$pred_intcpt
tb_SlpIP_Exp4 <- tmp_SlpIP
tb_SlpIP_Exp4_sub <- tmp_SlpIP_sub
tb_pred_bias_Exp4 <- tmp_pred_bias
plt_ip_Exp4 <- data.frame(ip_x = tmp_SlpIP$m_ip, ip_y = c(-0.15, -0.25, -0.3))

# Exp5
tmp_lm_wm = Data_Exp5 %>% group_by(WMSize,NSub) %>% do(model = lm(bias ~ curDur, data = .))
tmp_coef <- tibble()
for (x in 1:48) {
  tmp_coef <- bind_rows(tmp_coef, coef(tmp_lm_wm$model[[x]]))
}
tmp_coef$ind_pnt = -tmp_coef$`(Intercept)`/tmp_coef$curDur

tmp_SlpIP_sub <- tibble("NSub"=tmp_lm_wm$NSub, "WMSize"=tmp_lm_wm$WMSize, 
  "slope"=tmp_coef$curDur, "intercept"=tmp_coef$`(Intercept)`, "ind_pnt"=tmp_coef$ind_pnt)
tmp_SlpIP <- tmp_SlpIP_sub %>% dplyr::group_by(WMSize) %>%
  dplyr::summarize(n = n(), m_slope = mean(slope), se_slope=sd(slope)/sqrt(n-1),
                   m_intspt = mean(intercept), m_ip = mean(ind_pnt), se_ip=sd(ind_pnt)/sqrt(n-1))
# predict reproduction bias
tmp_pred_bias <- tibble(curDur = mRpr_Exp5$curDur, WMSize = mRpr_Exp5$WMSize)
tmp_pred_bias <- left_join(tmp_pred_bias, tmp_SlpIP, by = "WMSize")
tmp_pred_bias$pred_intcpt = -tmp_pred_bias$m_slope * tmp_pred_bias$m_ip
tmp_pred_bias$pred_y = tmp_pred_bias$curDur * tmp_pred_bias$m_slope + tmp_pred_bias$pred_intcpt
tb_SlpIP_Exp5 <- tmp_SlpIP
tb_SlpIP_Exp5_sub <- tmp_SlpIP_sub
tb_pred_bias_Exp5 <- tmp_pred_bias
plt_ip_Exp5 <- data.frame(ip_x = tmp_SlpIP$m_ip, ip_y = c(-0.15, -0.25, -0.3))

# Exp6
tmp_lm_wm = Data_Exp6 %>% group_by(Exp,WMSize,NSub) %>% do(model = lm(bias ~ curDur, data = .))
tmp_coef <- tibble()
for (x in 1:162) {
  tmp_coef <- bind_rows(tmp_coef, coef(tmp_lm_wm$model[[x]]))
}
tmp_coef$ind_pnt = -tmp_coef$`(Intercept)`/tmp_coef$curDur

tmp_SlpIP_sub <- tibble("NSub"=tmp_lm_wm$NSub, "exp"=tmp_lm_wm$Exp, "WMSize"=tmp_lm_wm$WMSize, 
  "slope"=tmp_coef$curDur, "intercept"=tmp_coef$`(Intercept)`, "ind_pnt"=tmp_coef$ind_pnt)
tmp_SlpIP <- tmp_SlpIP_sub %>% dplyr::group_by(exp,WMSize) %>%
  dplyr::summarize(n = n(), m_slope = mean(slope), se_slope=sd(slope)/sqrt(n-1),
                   m_intspt = mean(intercept), m_ip = mean(ind_pnt), se_ip=sd(ind_pnt)/sqrt(n-1))
# predict reproduction bias
tmp_pred_bias <- tibble(exp = mRpr_Exp6$Exp, curDur = mRpr_Exp6$curDur, WMSize = mRpr_Exp6$WMSize)
tmp_pred_bias <- left_join(tmp_pred_bias, tmp_SlpIP, by = c("exp", "WMSize"))
tmp_pred_bias$pred_intcpt = -tmp_pred_bias$m_slope * tmp_pred_bias$m_ip
tmp_pred_bias$pred_y = tmp_pred_bias$curDur * tmp_pred_bias$m_slope + tmp_pred_bias$pred_intcpt
tb_SlpIP_Exp6 <- tmp_SlpIP
tb_SlpIP_Exp6_sub <- tmp_SlpIP_sub
tb_pred_bias_Exp6 <- tmp_pred_bias
plt_ip_Exp6 <- data.frame(exp = tmp_SlpIP$exp, wm = tmp_SlpIP$WMSize, ip_x = tmp_SlpIP$m_ip)
plt_ip_Exp6 <- do.call("rbind", replicate(2, plt_ip_Exp6, simplify = FALSE))
plt_ip_Exp6$ip_y = c(-0.15, -0.25, -0.3, -0.15, -0.25, -0.3, -0.15, -0.25, -0.3, 
                     0,0,0,0,0,0,0,0,0)

```

```{r}
# ANOVA on linear-fitted slope and Indifference Point
##################################
# plot the linear-fitted indifference points and slopes of bias
plt_SlpIP_Exp1 <- ggplot(data = tb_SlpIP_Exp1_sub %>% group_by(WMSize)%>%
  dplyr::summarise(n=n(),
                   m_inP = mean(ind_pnt),
                   se_inP = sd(ind_pnt)/sqrt(n-1),
                   m_slope = mean(slope),
                   se_slope = sd(slope)/sqrt(n-1)), aes(x= m_slope, y=m_inP, color = WMSize))+
  geom_line(stat = "identity")+
  geom_point(stat = "identity")+ 
  geom_errorbar(width = 0.02, aes(ymin = m_inP - se_inP, ymax = m_inP + se_inP)) +
  geom_errorbarh(height =0.02, aes(xmin = m_slope - se_slope, xmax = m_slope + se_slope)) +
  theme_new+
  labs(colour = "Memory Load") + greySet3 +
  xlab('slope of reproduction bias')+ylab("indifference point (ms)")+guides(shape="none")+
  theme(legend.position = "top")
plt_SlpIP_Exp1

tmp_aov <- ezANOVA(data = tb_SlpIP_Exp1_sub, dv= slope,
                   wid = NSub, within = .(WMSize), detailed=TRUE)
tmp_aov$ANOVA$partial_eta2 <- tmp_aov$ANOVA$SSn/(tmp_aov$ANOVA$SSn+tmp_aov$ANOVA$SSd)
anova_slope_Exp1 <- tmp_aov
print(anova_slope_Exp1)

tmp_aov <- ezANOVA(data = tb_SlpIP_Exp1_sub, dv= ind_pnt,
                   wid = NSub, within = .(WMSize), detailed=TRUE)
tmp_aov$ANOVA$partial_eta2 <- tmp_aov$ANOVA$SSn/(tmp_aov$ANOVA$SSn+tmp_aov$ANOVA$SSd)
anova_indPt_Exp1 <- tmp_aov
print(anova_indPt_Exp1)

```


```{r}
# save wide dataframe to analyze (JASP)
##################################
# Exp 1-5
slpIP_Exp1_jasp <- subset(tb_SlpIP_Exp1_sub, select = c(WMSize, NSub, slope, ind_pnt)) %>% 
  pivot_wider(names_from = "WMSize", values_from = c(slope, ind_pnt), names_sep="_")
slpIP_Exp1_jasp

slpIP_Exp2_jasp <- subset(tb_SlpIP_Exp2_sub, select = c(WMSize, gap, NSub, slope, ind_pnt)) %>% 
  pivot_wider(names_from = c("WMSize", "gap"), values_from = c(slope, ind_pnt), names_sep="_")
slpIP_Exp2_jasp

slpIP_Exp3_jasp <- subset(tb_SlpIP_Exp3_sub, select = c(WMSize, NSub, slope, ind_pnt)) %>% 
  pivot_wider(names_from = "WMSize", values_from = c(slope, ind_pnt), names_sep="_")
slpIP_Exp3_jasp

slpIP_Exp4_jasp <- subset(tb_SlpIP_Exp4_sub, select = c(WMSize, NSub, slope, ind_pnt)) %>% 
  pivot_wider(names_from = "WMSize", values_from = c(slope, ind_pnt), names_sep="_")
slpIP_Exp4_jasp

slpIP_Exp5_jasp <- subset(tb_SlpIP_Exp5_sub, select = c(WMSize, NSub, slope, ind_pnt)) %>% 
  pivot_wider(names_from = "WMSize", values_from = c(slope, ind_pnt), names_sep="_")
slpIP_Exp5_jasp

# Exp 6
tb_SlpIP_Exp6_sub$Exp[tb_SlpIP_Exp6_sub$exp == "Exp. 6a"] <- "6a"
tb_SlpIP_Exp6_sub$Exp[tb_SlpIP_Exp6_sub$exp == "Exp. 6b"] <- "6b"
tb_SlpIP_Exp6_sub$Exp[tb_SlpIP_Exp6_sub$exp == "Exp. 6c"] <- "6c"
slpIP_Exp6_jasp <- subset(tb_SlpIP_Exp6_sub, select = c(Exp, WMSize, NSub, slope, ind_pnt)) %>% 
  pivot_wider(names_from = c("Exp", "WMSize"), values_from = c(slope, ind_pnt), names_sep="_")
slpIP_Exp6_jasp

## save csv
write.csv(slpIP_Exp1_jasp, paste0(getwd(), "/bhvrlt/slope_ip_Exp1.csv"))
write.csv(slpIP_Exp2_jasp, paste0(getwd(), "/bhvrlt/slope_ip_Exp2.csv"))
write.csv(slpIP_Exp3_jasp, paste0(getwd(), "/bhvrlt/slope_ip_Exp3.csv"))
write.csv(slpIP_Exp4_jasp, paste0(getwd(), "/bhvrlt/slope_ip_Exp4.csv"))
write.csv(slpIP_Exp5_jasp, paste0(getwd(), "/bhvrlt/slope_ip_Exp5.csv"))
write.csv(slpIP_Exp6_jasp, paste0(getwd(), "/bhvrlt/slope_ip_Exp6.csv"))

```

```{r}
# plot estimated slope (bar)
##################################

# Exp 1
plt_bar_SlpIP_Exp1 <- ggplot(tb_SlpIP_Exp1, aes(x=WMSize,y=m_slope)) +
  geom_bar(stat="identity", fill="lightgrey", position=position_dodge()) +
  geom_errorbar(aes(ymin=m_slope-se_slope, ymax=m_slope+se_slope), 
                width=.1,  position = position_dodge()) +
  geom_signif(annotations=c("**","**"), tip_length = -0.1, vjust=2.5,
              y_position = c(-0.63,-0.63), xmin = c(1, 2.1), xmax = c(1.9, 3),
              color = 'black') +
  coord_cartesian(ylim = c(-0.7, 0)) +
  labs(x="Memory Load", y="Estimated slope", title="Reproduction bias slope") + 
  theme_new + theme(legend.position = "bottom", legend.justification = c("center", "top"),
                    plot.title = element_text(hjust = 0.5))
plt_bar_SlpIP_Exp1

# Exp 2
plt_bar_SlpIP_Exp2 <- ggplot(tb_SlpIP_Exp2, aes(x=gap,y=m_slope,
                                               group=interaction(WMSize, gap))) +
  geom_bar(stat="identity", aes(fill=WMSize), position=position_dodge()) +
  geom_errorbar(aes(x=gap, ymin=m_slope-se_slope, ymax=m_slope+se_slope), 
                width=.1,  position = position_dodge(.9)) +
  geom_signif(annotations=c("*","**"), 
              tip_length = -0.1, vjust=2.5,
              y_position = c(-0.6, -0.7), 
              xmin = c(1.7, 1.7), 
              xmax = c(1.95, 2.3),
              color = 'black') +
  coord_cartesian(ylim = c(-0.85, 0)) +
  labs(x="Gap", y="Estimated slope", fill="Memory Load", 
       title="Reproduction bias slope") + 
  theme_new + fillGreySet3 + 
  theme(legend.position = "bottom",
        plot.title = element_text(hjust = 0.5))
plt_bar_SlpIP_Exp2

# Exp 3
plt_bar_SlpIP_Exp3 <- ggplot(tb_SlpIP_Exp3, aes(x=WMSize,y=m_slope)) +
  geom_bar(stat="identity", fill="lightgrey", position=position_dodge()) +
  geom_errorbar(aes(ymin=m_slope-se_slope, ymax=m_slope+se_slope), 
                width=.1,  position = position_dodge()) +
  geom_signif(annotations=c("***"), tip_length = -0.1, vjust=2.5,
              y_position = c(-0.73), xmin = c(1), xmax = c(1.9),
              color = 'black') +
  coord_cartesian(ylim = c(-0.85, 0)) +
  labs(x="Memory Load", y="Estimated slope", title="Reproduction bias slope") + 
  theme_new + theme(legend.position = "bottom", legend.justification = c("center", "top"),
                    plot.title = element_text(hjust = 0.5))
plt_bar_SlpIP_Exp3

# Exp 4
plt_bar_SlpIP_Exp4 <- ggplot(tb_SlpIP_Exp4, aes(x=WMSize,y=m_slope)) +
  geom_bar(stat="identity", fill="lightgrey", position=position_dodge()) +
  geom_errorbar(aes(ymin=m_slope-se_slope, ymax=m_slope+se_slope), 
                width=.1,  position = position_dodge()) +
  coord_cartesian(ylim = c(-0.75, 0)) +
  labs(x="Memory Load", y="Estimated slope", title="Reproduction bias slope") + 
  theme_new + theme(legend.position = "bottom", legend.justification = c("center", "top"),
                    plot.title = element_text(hjust = 0.5))
plt_bar_SlpIP_Exp4

# Exp 5
plt_bar_SlpIP_Exp5 <- ggplot(tb_SlpIP_Exp5, aes(x=WMSize,y=m_slope)) +
  geom_bar(stat="identity", fill="lightgrey", position=position_dodge()) +
  geom_errorbar(aes(ymin=m_slope-se_slope, ymax=m_slope+se_slope), 
                width=.1,  position = position_dodge()) +
  coord_cartesian(ylim = c(-0.65, 0)) +
  labs(x="Memory Load", y="Estimated slope", title="Reproduction bias slope") + 
  theme_new + theme(legend.position = "bottom", legend.justification = c("center", "top"),
                    plot.title = element_text(hjust = 0.5))
plt_bar_SlpIP_Exp5

# Exp 6
plt_bar_SlpIP_Exp6 <- ggplot(tb_SlpIP_Exp6, aes(x=exp,y=m_slope,
                                               group=interaction(WMSize, exp))) +
  geom_bar(stat="identity", aes(fill=WMSize), position=position_dodge()) +
  geom_errorbar(aes(ymin=m_slope-se_slope, ymax=m_slope+se_slope), 
                width=.1,  position = position_dodge(.9)) +
  geom_signif(annotations=c("**","***"),
              tip_length = -0.1, vjust=2.5,
              y_position = c(-0.48, -0.56),
              xmin = c(0.7, 0.7),
              xmax = c(0.95, 1.3),
              color = 'black') +
  coord_cartesian(ylim = c(-0.65, 0)) +
  labs(x="Experiment", y="Estimated slope", fill="Memory Load", 
       title="Reproduction bias slope") + 
  theme_new + fillGreySet3 + 
  theme(legend.position = "bottom", 
        plot.title = element_text(hjust = 0.5))
plt_bar_SlpIP_Exp6

```

```{r}
# plot estimated slope and IP
##################################

# Exp1
tmp_predBias <- tb_pred_bias_Exp1
tmp_tb_slpIp <- tb_SlpIP_Exp1
tmp_ip_df <- plt_ip_Exp1
plt_SlpIP_Exp1 <- ggplot() +
  geom_hline(yintercept = 0, linetype='dashed') +
  geom_line(data = tmp_predBias, aes(curDur, pred_y, group = WMSize, 
                                  color=as.factor(WMSize)),linewidth = 1) +
  annotate("segment", x = tmp_tb_slpIp$m_ip[1], y = tmp_ip_df$ip_y[1], 
           xend = tmp_tb_slpIp$m_ip[1], yend = 0, color = "grey") +
  annotate("segment", x = tmp_tb_slpIp$m_ip[2], y = tmp_ip_df$ip_y[2], 
         xend = tmp_tb_slpIp$m_ip[2], yend = 0, color = "orange") +
  annotate("segment", x = tmp_tb_slpIp$m_ip[3], y = tmp_ip_df$ip_y[3], 
         xend = tmp_tb_slpIp$m_ip[3], yend = 0, color = "lightblue") +
  geom_errorbar(data = tmp_tb_slpIp, 
                aes(m_ip, c(-0.15, -0.25, -0.3), xmin = m_ip - se_ip, 
                    xmax = m_ip + se_ip, group = WMSize, color=as.factor(WMSize)),
                orientation = "y", width =.02) +
  coord_cartesian(ylim = c(-0.5, 0.4)) +
  scale_x_continuous(breaks=c(0.5, 0.8, 1.1, 1.4, 1.7)) +
  labs(x="Durations (s)", y="Estimated Reproduction bias (s)", color = "Memory Load")+
  theme_new + colorSet3 +
  theme(legend.position = "top", legend.justification = c(.8, .8),
        legend.text = element_text(size = 10), 
        legend.title = element_text(size = 10, face = "bold"))

# Exp2
tmp_predBias <- tb_pred_bias_Exp2
tmp_tb_slpIp <- tb_SlpIP_Exp2
tmp_ip_df <- plt_ip_Exp2
plt_SlpIP_Exp2 <- ggplot() +
  geom_hline(yintercept = 0, linetype='dashed') +
  geom_line(data = tmp_predBias, 
          aes(curDur, pred_y, group = interaction(WMSize, gap), color=as.factor(WMSize),
              linetype=gap), linewidth = 1) +
    annotate("segment", x = tmp_tb_slpIp$m_ip[1], y = tmp_ip_df$ip_y[1], 
           xend = tmp_tb_slpIp$m_ip[1], yend = 0, color = "grey") +
  annotate("segment", x = tmp_tb_slpIp$m_ip[2], y = tmp_ip_df$ip_y[2], 
         xend = tmp_tb_slpIp$m_ip[2], yend = 0, color = "orange") +
  annotate("segment", x = tmp_tb_slpIp$m_ip[3], y = tmp_ip_df$ip_y[3], 
         xend = tmp_tb_slpIp$m_ip[3], yend = 0, color = "lightblue") +
    annotate("segment", x = tmp_tb_slpIp$m_ip[4], y = tmp_ip_df$ip_y[4], 
           xend = tmp_tb_slpIp$m_ip[4], yend = 0, color = "grey") +
  annotate("segment", x = tmp_tb_slpIp$m_ip[5], y = tmp_ip_df$ip_y[5], 
         xend = tmp_tb_slpIp$m_ip[5], yend = 0, color = "orange") +
  annotate("segment", x = tmp_tb_slpIp$m_ip[6], y = tmp_ip_df$ip_y[6], 
         xend = tmp_tb_slpIp$m_ip[6], yend = 0, color = "lightblue") +
  geom_errorbar(data = tmp_tb_slpIp, 
                aes(m_ip, c(-0.15, -0.25, -0.3, -0.18, -0.28, -0.33), 
                    xmin = m_ip - se_ip, xmax = m_ip + se_ip, 
                    group = interaction(WMSize, gap), color=as.factor(WMSize)),
                orientation = "y", width =.02)  +
  coord_cartesian(ylim = c(-0.5, 0.4)) +
  scale_x_continuous(breaks=c(0.5, 0.8, 1.1, 1.4, 1.7)) +
  theme_new + colorSet3 +
  labs(x="Durations (s)", y="Estimated Reproduction bias (s)", color = "Memory Load")+
  theme(legend.position = "top", legend.justification = c(.8, .8),
        legend.text = element_text(size = 10), 
        legend.title = element_text(size = 10, face = "bold")) +
  guides(linetype = guide_legend(order = 1), 
         colour = guide_legend(order = 2))

# Exp3
tmp_predBias <- tb_pred_bias_Exp3
tmp_tb_slpIp <- tb_SlpIP_Exp3
tmp_ip_df <- plt_ip_Exp3
plt_SlpIP_Exp3 <- ggplot() +
  geom_hline(yintercept = 0, linetype='dashed') +
  geom_line(data = tmp_predBias, aes(curDur, pred_y, group = WMSize, 
                                  color=as.factor(WMSize)),linewidth = 1) +
  annotate("segment", x = tmp_tb_slpIp$m_ip[1], y = tmp_ip_df$ip_y[1], 
           xend = tmp_tb_slpIp$m_ip[1], yend = 0, color = "grey") +
  annotate("segment", x = tmp_tb_slpIp$m_ip[2], y = tmp_ip_df$ip_y[2], 
         xend = tmp_tb_slpIp$m_ip[2], yend = 0, color = "orange") +
  annotate("segment", x = tmp_tb_slpIp$m_ip[3], y = tmp_ip_df$ip_y[3], 
         xend = tmp_tb_slpIp$m_ip[3], yend = 0, color = "lightblue") +
  geom_errorbar(data = tmp_tb_slpIp, 
                aes(m_ip, c(-0.15, -0.25, -0.3), xmin = m_ip - se_ip, 
                    xmax = m_ip + se_ip, group = WMSize, color=as.factor(WMSize)),
                orientation = "y", width =.02) +
  coord_cartesian(ylim = c(-0.5, 0.4)) +
  scale_x_continuous(breaks=c(0.5, 0.8, 1.1, 1.4, 1.7)) +
  labs(x="Durations (s)", y="Estimated Reproduction bias (s)", color = "Memory Load")+
  theme_new + colorSet3 +
  theme(legend.position = "top", legend.justification = c(.8, .8),
        legend.text = element_text(size = 10), 
        legend.title = element_text(size = 10, face = "bold"))

# Exp4
tmp_predBias <- tb_pred_bias_Exp4
tmp_tb_slpIp <- tb_SlpIP_Exp4
tmp_ip_df <- plt_ip_Exp4
plt_SlpIP_Exp4 <- ggplot() +
  geom_hline(yintercept = 0, linetype='dashed') +
  geom_line(data = tmp_predBias, aes(curDur, pred_y, group = WMSize, 
                                  color=as.factor(WMSize)),linewidth = 1) +
  annotate("segment", x = tmp_tb_slpIp$m_ip[1], y = tmp_ip_df$ip_y[1], 
           xend = tmp_tb_slpIp$m_ip[1], yend = 0, color = "grey") +
  annotate("segment", x = tmp_tb_slpIp$m_ip[2], y = tmp_ip_df$ip_y[2], 
         xend = tmp_tb_slpIp$m_ip[2], yend = 0, color = "orange") +
  annotate("segment", x = tmp_tb_slpIp$m_ip[3], y = tmp_ip_df$ip_y[3], 
         xend = tmp_tb_slpIp$m_ip[3], yend = 0, color = "lightblue") +
  geom_errorbar(data = tmp_tb_slpIp, 
                aes(m_ip, c(-0.15, -0.25, -0.3), xmin = m_ip - se_ip, 
                    xmax = m_ip + se_ip, group = WMSize, color=as.factor(WMSize)),
                orientation = "y", width =.02) +
  coord_cartesian(ylim = c(-0.5, 0.4)) +
  scale_x_continuous(breaks=c(0.5, 0.8, 1.1, 1.4, 1.7)) +
  labs(x="Durations (s)", y="Estimated Reproduction bias (s)", color = "Memory Load")+
  theme_new + colorSet3 +
  theme(legend.position = "top", legend.justification = c(.8, .8),
        legend.text = element_text(size = 10), 
        legend.title = element_text(size = 10, face = "bold"))

# Exp5
tmp_predBias <- tb_pred_bias_Exp5
tmp_tb_slpIp <- tb_SlpIP_Exp5
tmp_ip_df <- plt_ip_Exp5
plt_SlpIP_Exp5 <- ggplot() +
  geom_hline(yintercept = 0, linetype='dashed') +
  geom_line(data = tmp_predBias, aes(curDur, pred_y, group = WMSize, 
                                  color=as.factor(WMSize)),linewidth = 1) +
  annotate("segment", x = tmp_tb_slpIp$m_ip[1], y = tmp_ip_df$ip_y[1], 
           xend = tmp_tb_slpIp$m_ip[1], yend = 0, color = "grey") +
  annotate("segment", x = tmp_tb_slpIp$m_ip[2], y = tmp_ip_df$ip_y[2], 
         xend = tmp_tb_slpIp$m_ip[2], yend = 0, color = "orange") +
  annotate("segment", x = tmp_tb_slpIp$m_ip[3], y = tmp_ip_df$ip_y[3], 
         xend = tmp_tb_slpIp$m_ip[3], yend = 0, color = "lightblue") +
  geom_errorbar(data = tmp_tb_slpIp, 
                aes(m_ip, c(-0.15, -0.25, -0.3), xmin = m_ip - se_ip, 
                    xmax = m_ip + se_ip, group = WMSize, color=as.factor(WMSize)),
                orientation = "y", width =.02) +
  coord_cartesian(ylim = c(-0.5, 0.4)) +
  scale_x_continuous(breaks=c(0.5, 0.8, 1.1, 1.4, 1.7)) +
  labs(x="Durations (s)", y="Estimated Reproduction bias (s)", color = "Memory Load")+
  theme_new + colorSet3 +
  theme(legend.position = "top", legend.justification = c(.8, .8),
        legend.text = element_text(size = 10), 
        legend.title = element_text(size = 10, face = "bold"))

# Exp6
tmp_predBias <- tb_pred_bias_Exp6
tmp_tb_slpIp <- tb_SlpIP_Exp6
tmp_ip_df <- plt_ip_Exp6
plt_SlpIP_Exp6 <- 
  ggplot() +
  geom_hline(yintercept = 0, linetype='dashed') +
  geom_line(data = tmp_predBias, 
          aes(curDur, pred_y, group = interaction(WMSize, exp), color=as.factor(WMSize)), 
          linewidth = 1) +
  geom_line(data = tmp_ip_df, 
          aes(ip_x, ip_y, group = interaction(wm, exp), color=as.factor(wm)), 
          linewidth = 0.2, show.legend = FALSE) +
  geom_errorbar(data = tmp_tb_slpIp, 
                aes(m_ip, c(-0.15, -0.25, -0.3, -0.15, -0.25, -0.3, -0.15, -0.25, -0.3), 
                    xmin = m_ip - se_ip, xmax = m_ip + se_ip, 
                    group = interaction(WMSize, exp), color=as.factor(WMSize)),
                orientation = "y", width =.02)  +
  facet_wrap("exp") +
  coord_cartesian(ylim = c(-0.35, 0.2)) +
  scale_x_continuous(breaks=c(0.5, 0.8, 1.1, 1.4, 1.7)) +
  theme_new + colorSet3 +
  labs(x="Durations (s)", y="Estimated Reproduction bias (s)", color = "Memory Load")+
  theme(legend.position = "top", legend.justification = c(.8, .8),
        legend.text = element_text(size = 10), 
        legend.title = element_text(size = 10, face = "bold"))
  #theme(legend.position = "none")


plt_SlpIP_Exp1
plt_SlpIP_Exp2
plt_SlpIP_Exp3
plt_SlpIP_Exp4
plt_SlpIP_Exp5
plt_SlpIP_Exp6
```

# combine figures for each experiment
```{r}
plt_Exp1 <- ggarrange(plt_RprBias_Exp1, plt_bar_SlpIP_Exp1, plt_bar_WMCrr_Exp1, 
                      labels = c("a", "b","c"), 
                      ncol=3, nrow=1, widths = c(4,4,4))
plt_Exp1

plt_Exp2 <- ggarrange(plt_RprBias_Exp2, plt_bar_SlpIP_Exp2, plt_bar_WMCrr_Exp2, 
                      common.legend = TRUE, legend = c("bottom"), labels = c("a", "b","c"), 
                      ncol=3, nrow=1, widths = c(4,4,4))
plt_Exp2

plt_Exp3 <- ggarrange(plt_RprBias_Exp3, plt_bar_SlpIP_Exp3, plt_bar_WMCrr_Exp3, 
                      labels = c("a", "b","c"), 
                      ncol=3, nrow=1, widths = c(4,4,4))
plt_Exp3

plt_Exp4 <- ggarrange(plt_RprBias_Exp4, plt_bar_SlpIP_Exp4, plt_bar_WMCrr_Exp4, 
                      labels = c("a", "b","c"), 
                      ncol=3, nrow=1, widths = c(4,4,4))
plt_Exp4

plt_Exp5 <- ggarrange(plt_RprBias_Exp5, plt_bar_SlpIP_Exp5, plt_bar_WMCrr_Exp5, 
                      labels = c("a", "b","c"), 
                      ncol=3, nrow=1, widths = c(4,4,4))
plt_Exp5

plt_Exp6 <- ggarrange(plt_RprBias_Exp6, plt_bar_SlpIP_Exp6, plt_bar_WMCrr_Exp6, 
                      common.legend = TRUE, legend = c("bottom"),labels = c("a", "b","c"), 
                      ncol=3, nrow=1, widths = c(5,3.5,3.5))
plt_Exp6

plt_Exp6_wide <- ggarrange(plt_RprBias_Exp6, 
                      ggarrange(plt_bar_SlpIP_Exp6, plt_bar_WMCrr_Exp6,labels = c("b","c"), 
                      legend = c("none"), ncol=2, nrow=1, widths = c(3.5,3.5)), 
                      common.legend = TRUE, legend = c("bottom"),labels = c("a", ""), 
                      ncol=1, nrow=2, heights = c(5,5))
plt_Exp6_wide

# save the plots to .png files
ggsave(paste0(getwd(), "/figures/plt_FigRvs4_Exp1.png"), 
       plt_Exp1, width = 8.5, height = 3.54)
ggsave(paste0(getwd(), "/figures/plt_FigRvs4_Exp2.png"), 
       plt_Exp2, width = 8.5, height = 3.54)
ggsave(paste0(getwd(), "/figures/plt_FigRvs4_Exp3.png"), 
       plt_Exp3, width = 8.5, height = 3.54)
ggsave(paste0(getwd(), "/figures/plt_FigRvs4_Exp4.png"), 
       plt_Exp4, width = 8.5, height = 3.54)
ggsave(paste0(getwd(), "/figures/plt_FigRvs4_Exp5.png"), 
       plt_Exp5, width = 8.5, height = 3.54)
ggsave(paste0(getwd(), "/figures/plt_FigRvs4_Exp6.png"), 
       plt_Exp6, width = 8.5, height = 3.54)

ggsave(paste0(getwd(), "/figures/plt_FigRvs4_Exp6_wide.png"), 
       plt_Exp6_wide, width = 5, height = 6)

```


```{r}

plt_RprBias_Exp2
plt_RprBias_Exp3
plt_RprBias_Exp4
plt_RprBias_Exp5
plt_RprBias_Exp6
plt_bar_SlpIP_Exp1
plt_bar_WMCrr_Exp6



plt_Exp2 <- ggarrange(plt_WMCrr_Exp2, plt_RprBias_Exp2, plt_SlpIP_Exp2, 
                      common.legend = TRUE, labels = c("a", "b","c"), 
                      ncol=3, nrow=1, widths = c(4,4,4))
plt_Exp2

plt_Exp3 <- ggarrange(plt_WMCrr_Exp3, plt_RprBias_Exp3, plt_SlpIP_Exp3, 
                      common.legend = TRUE, labels = c("a", "b","c"), 
                      ncol=3, nrow=1, widths = c(4,4,4))
plt_Exp3

plt_Exp4 <- ggarrange(plt_WMCrr_Exp4, plt_RprBias_Exp4, plt_SlpIP_Exp4, 
                      common.legend = TRUE, labels = c("a", "b","c"), 
                      ncol=3, nrow=1, widths = c(4,4,4))
plt_Exp4

plt_Exp5 <- ggarrange(plt_WMCrr_Exp5, plt_RprBias_Exp5, plt_SlpIP_Exp5, 
                      common.legend = TRUE, labels = c("a", "b","c"), 
                      ncol=3, nrow=1, widths = c(4,4,4))
plt_Exp5

plt_Exp6_1 <- ggarrange(plt_WMCrr_Exp6, plt_RprBias_Exp6, common.legend = FALSE, 
                      ncol=2, nrow=1, widths = c(3,6), labels = c("a", "b"))
plt_Exp6_1

#plt_Exp6_2 <- ggarrange(plt_RprBias_Exp6, plt_SlpIP_Exp6, labels=c("a", "b"), 
#                      nrow = 2, heights = c(9,8))
#plt_Exp6_2

plt_Exp6_2 <- ggarrange(plt_SlpIP_Exp6, labels=c("c"), 
                      nrow = 1, heights = c(9))
plt_Exp6_2

##### linear-fitted plot only
plt_Exp1 <- ggarrange(plt_WMCrr_Exp1, plt_SlpIP_Exp1, 
                      common.legend = TRUE, labels = c("a", "b"), 
                      ncol=2, nrow=1, widths = c(4,4))
plt_Exp1

plt_Exp2 <- ggarrange(plt_WMCrr_Exp2, plt_SlpIP_Exp2, 
                      common.legend = TRUE, labels = c("a", "b"), 
                      ncol=2, nrow=1, widths = c(4,4))
plt_Exp2

plt_Exp3 <- ggarrange(plt_WMCrr_Exp3, plt_SlpIP_Exp3, 
                      common.legend = TRUE, labels = c("a", "b"), 
                      ncol=2, nrow=1, widths = c(4,4))
plt_Exp3

plt_Exp4 <- ggarrange(plt_WMCrr_Exp4, plt_SlpIP_Exp4, 
                      common.legend = TRUE, labels = c("a", "b"), 
                      ncol=2, nrow=1, widths = c(4,4))
plt_Exp4

plt_Exp5 <- ggarrange(plt_WMCrr_Exp5, plt_SlpIP_Exp5, 
                      common.legend = TRUE, labels = c("a", "b"), 
                      ncol=2, nrow=1, widths = c(4,4))
plt_Exp5

plt_Exp6_3 <- ggarrange(plt_WMCrr_Exp6, plt_SlpIP_Exp6, common.legend = FALSE, 
                      ncol=2, nrow=1, widths = c(3,6), labels = c("a", "b"))
plt_Exp6_3

# save the plots to .png files
ggsave(paste0(getwd(), "/figures/plt_FigRvs4_Exp1.png"), 
       plt_Exp1, width = 8.5, height = 3.54)
ggsave(paste0(getwd(), "/figures/plt_FigRvs4_Exp2.png"), 
       plt_Exp2, width = 8.5, height = 3.54)
ggsave(paste0(getwd(), "/figures/plt_FigRvs4_Exp3.png"), 
       plt_Exp3, width = 8.5, height = 3.54)
ggsave(paste0(getwd(), "/figures/plt_FigRvs4_Exp4.png"), 
       plt_Exp4, width = 8.5, height = 3.54)
ggsave(paste0(getwd(), "/figures/plt_FigRvs4_Exp5.png"), 
       plt_Exp5, width = 8.5, height = 3.54)
ggsave(paste0(getwd(), "/figures/plt_FigRvs4_Exp6_3.png"), 
       plt_Exp6_3, width = 8.5, height = 3.54)


ggsave(paste0(getwd(), "/figures/plt_FigRvs4_Exp6_1.png"), 
       plt_Exp6_1, width = 8.5, height = 3.54)
ggsave(paste0(getwd(), "/figures/plt_FigRvs4_Exp6_2.png"), 
       plt_Exp6_2, width = 8.5, height = 3)

```




```{r}

mRpr_sub <- dplyr::group_by(Data_Exp1, curDur, NSub, WMSize) %>%
  dplyr::summarize(n = n(), m_repDur = mean(repDur), sd_repDur = sd(repDur),
                   cv = sd_repDur/ m_repDur, mBias = mean(bias), sdBias = sd(bias))
mRpr <- mRpr_sub %>% dplyr::group_by(curDur, WMSize) %>% 
  dplyr::summarize(n = n(), m_m_repDur = mean(m_repDur),
                   m_bias = mean(m_repDur-curDur), 
                   se_bias = sd(m_repDur-curDur)/sqrt(n-1),
                   m_cv= mean(cv), se_cv=sd(cv)/sqrt(n-1))

# Exp 1: plot Dur-Rpr-WM for original Exp 4
plt_RprBias_Exp1 <- ggplot(data = mRpr,
                           aes(curDur, m_bias, ymin = m_bias - se_bias, 
                               ymax = m_bias + se_bias, group = WMSize,
                               color = as.factor(WMSize), 
                               shape = as.factor(WMSize))) +
  geom_line(aes(color = WMSize), 
            stat = "identity",position = position_dodge(width = 0.05)) +
  geom_hline(yintercept = 0, linetype='dashed') +
  geom_point(size = 2, stat="identity", position=position_dodge(width=0.05)) +
  geom_errorbar(width=.2,  position = position_dodge(width = 0.05)) +
  coord_cartesian(ylim = c(-0.5, 0.4)) +
  scale_x_continuous(breaks=c(0.5, 0.8, 1.1, 1.4, 1.7)) +
  labs(x="Durations (s)", y="Reproduction bias (s)", 
       shape ="Memory Load", color = "Memory Load")+
  theme_new + colorSet3 +
  theme(legend.position = "top", legend.justification = c(.8, .8),
        legend.text = element_text(size = 10), 
        legend.title = element_text(size = 10, face = "bold"))
plt_RprBias_Exp1

# plot subject #10 only
  
plt_RprBias_sub10 <- ggplot(data = mRpr_sub %>% filter(NSub==410),
                           aes(curDur, mBias, ymin = mBias - sdBias, 
                               ymax = mBias + sdBias, group = WMSize,
                               color = as.factor(WMSize), 
                               shape = as.factor(WMSize))) +
  geom_line(aes(color = WMSize), 
            stat = "identity",position = position_dodge(width = 0.05)) +
  geom_hline(yintercept = 0, linetype='dashed') +
  geom_point(size = 2, stat="identity", position=position_dodge(width=0.05)) +
  geom_errorbar(width=.2,  position = position_dodge(width = 0.05)) +
  coord_cartesian(ylim = c(-0.5, 0.4)) +
  scale_x_continuous(breaks=c(0.5, 0.8, 1.1, 1.4, 1.7)) +
  labs(x="Durations (s)", y="Reproduction bias (s)", 
       shape ="Memory Load", color = "Memory Load")+
  theme_new + colorSet3 +
  theme(legend.position = "top", legend.justification = c(.8, .8),
        legend.text = element_text(size = 10), 
        legend.title = element_text(size = 10, face = "bold"))
plt_RprBias_sub10




```


```{r}
pred_bias
tb_SlpIP
c(tb_SlpIP$m_ip, ip_df)
```



```{r}
lm_prep = Data_Exp1 %>% group_by(NSub,WMSize)
lm_Exp1_wm = lm_prep %>% do(model = lm(bias ~ curDur, data = .))
lm_Exp1_wm$model
summary(lm_Exp1_wm[[3]][[1]])

lm_Exp1 = lm(bias ~ curDur, data = Data_Exp1)
lm_Exp1$model

library(broom)

lm_prep = Data_Exp1 %>% group_by(NSub)
fits <- lmList(bias ~ curDur | WMSize, data = lm_prep)
fits

library(purrr)
map_df(list(lm_Exp1_wm[[3]][[1]]), tidy)


library(dplyr)

bind_rows(as.data.frame(coef(summary(lm_Exp1_wm[[3]][[1]]))), as.data.frame(coef(summary(lm_Exp1_wm[[3]][[2]]))))

a <- summary(lm_Exp1_wm[[3]][[1]])$coefficients[1:2]
summary(lm_Exp1_wm[[3]][[1]])$adj.r.squared
a$coefficients[1:2]
a$adj.r.squared



```


```{r}
# explore fitting CV of reproduction
##################################
modelversion = 'gap_log_rstan'
rstanmodelPath = 'modelrlt'
modelPath = paste0(rstanmodelPath, '/models/', modelversion)
## load model Prediction results
AllDat_predY <- read.csv(paste0(modelPath, "/rlt/AllDat_predY_",modelversion,".csv"))
AllDat_predY$WMSize <- as.factor(AllDat_predY$WMSize)
levels(AllDat_predY$WMSize) = c("low", "medium",  "high")
AllDat_predY$pred_Bias = AllDat_predY$mu_r - AllDat_predY$curDur
AllDat_predY$predErr = AllDat_predY$mu_r - AllDat_predY$repDur
AllDat_predY$relatErr = AllDat_predY$predErr / AllDat_predY$repDur
# rename experiments by replacing first 3 chracters "Exp" with string "Exp. "
AllDat_predY$Exp <- gsub("^.{0,3}", "Exp. ", AllDat_predY$Exp)
AllDat_predY[which(AllDat_predY$Exp == 'Exp. 4'),"Exp"] = "Exp. 4a"
AllDat_predY[which(AllDat_predY$Exp == 'Exp. 5'),"Exp"] = "Exp. 4b"
AllDat_predY$Exp = as.factor(AllDat_predY$Exp)
AllDat_predY$gap = 1
AllDat_predY[which(AllDat_predY$Gap == 2500),"gap"] = 2
AllDat_predY$gap <- factor(AllDat_predY$gap, labels = c("short", "long"))


AllDat_newY <- read.csv(paste0(modelPath, "/rlt/AllDat_newY_",modelversion,".csv"))
AllDat_newY$WMSize <- as.factor(AllDat_newY$WMSize)
levels(AllDat_newY$WMSize) = c("low", "medium",  "high")
AllDat_newY$Exp <- gsub("^.{0,3}", "Exp. ", AllDat_newY$Exp)
AllDat_newY[which(AllDat_newY$Exp == 'Exp. 4'),"Exp"] = "Exp. 4a"
AllDat_newY[which(AllDat_newY$Exp == 'Exp. 5'),"Exp"] = "Exp. 4b"
AllDat_newY$Exp = as.factor(AllDat_newY$Exp)
AllDat_newY$gap = 1
AllDat_newY[which(AllDat_newY$Gap == 2500),"gap"] = 2
AllDat_newY$gap <- factor(AllDat_newY$gap, labels = c("short", "long"))

m_newY_sub <- dplyr::group_by(AllDat_newY, curDur, Exp, NSub, WMSize) %>%
  dplyr::summarize(n = n(), m_predY = mean(predY), m_sig_r = mean(sig_r))
m_newY <- m_newY_sub %>% dplyr::group_by(Exp, curDur, WMSize) %>% 
  dplyr::summarize(n = n(), m_m_sig_r = mean(m_sig_r), m_m_predY = mean(m_predY),
                   se_m_sig_r = sd(m_sig_r)/sqrt(n-1), se_m_predY = sd(m_predY)/sqrt(n-1))
#
m_predY_sub <- dplyr::group_by(AllDat_predY, curDur, Exp, NSub, WMSize) %>%
  dplyr::summarize(n = n(), m_repDur = mean(repDur), sd_repDur = sd(repDur),
                   cv = sd_repDur/m_repDur, 
                   mBias = mean(repDur-curDur), sdBias = sd(repDur-curDur), 
                   m_predY = mean(predY), sd_predY = sd(predY),
                   m_sig_r = mean(sig_r), sd_sig_r = sd(sig_r))
m_predY <- m_predY_sub %>% dplyr::group_by(Exp, curDur, WMSize) %>% 
  dplyr::summarize(n = n(), m_m_repDur = mean(m_repDur), m_sd_repDur = mean(sd_repDur),
                   m_bias = mean(m_repDur-curDur), 
                   se_bias = sd(m_repDur-curDur)/sqrt(n-1),
                   m_cv= mean(cv), se_cv=sd(cv)/sqrt(n-1))

# plot CV of reproduction
curDurItem <- unique(m_predY$curDur)
RP_CV <- ggplot(data= m_predY, aes(x=curDur, y= m_sd_repDur/m_m_repDur, color=WMSize, shape = as.factor('Observation'))) +
  geom_point(size=2, alpha = 0.5)+
  geom_line(data = m_newY, aes(x=curDur, y=m_m_sig_r/m_m_predY, color=WMSize)) +
  geom_line(data = m_newY, aes(x=curDur, y=m_m_sig_r, color=WMSize)) +
  geom_line(data = m_newY, aes(x=curDur, y=m_m_predY, color=WMSize)) +
  #geom_point(data= m_newY %>% filter(curDur %in% curDurItem), aes(x=curDur, y=m_sig_r/m_predY, color=WMSize,  shape = as.factor('Prediction')),alpha = 0.5) +
  facet_grid(~Exp) +
  labs(x="Sample intervals (s)", y=" CV (s)", shape=" ", color = "Memory Load")+ theme_new+
  theme(strip.background = element_blank(),
        strip.text.x = element_blank())+
  colorSet3
RP_CV

```


